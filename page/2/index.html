<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=7.0.0"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.0',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。">
<meta property="og:type" content="website">
<meta property="og:title" content="VioletJack 技术日志">
<meta property="og:url" content="https://violetjack.github.io/page/2/index.html">
<meta property="og:site_name" content="VioletJack 技术日志">
<meta property="og:description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="VioletJack 技术日志">
<meta name="twitter:description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。">



  <link rel="alternate" href="/atom.xml" title="VioletJack 技术日志" type="application/atom+xml"/>




  <link rel="canonical" href="https://violetjack.github.io/page/2/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>VioletJack 技术日志</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">VioletJack 技术日志</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">专注！坚持！求真！</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>Startseite</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br/>Über</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>Archiv</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/04/12/Vue.js源码学习九 —— 过渡效果 transition 学习/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/12/Vue.js源码学习九 —— 过渡效果 transition 学习/" class="post-title-link" itemprop="url">Vue.js 源码学习九 —— 过渡效果 transition 学习</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-04-12 00:00:00" itemprop="dateCreated datePublished" datetime="2018-04-12T00:00:00+08:00">2018-04-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2019-02-16 01:20:56" itemprop="dateModified" datetime="2019-02-16T01:20:56+08:00">2019-02-16</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在学习 element ui 时，发现组件的过渡用的是 Vue.js 提供的 <transition> 标签。这里来好好认识下 vue 的过渡到底是如何工作的。</transition></p>
</blockquote>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>废话不多说，详细的内容请看<a href="https://cn.vuejs.org/v2/guide/transitions.html" target="_blank" rel="noopener">官方文档</a>，里面有详细的分析和例子够你看懂了（就是费时间~）。简单说说我对 vue 过渡的理解。经过一下午的折腾，总结出以下几点：</p>
<ul>
<li><strong>有四种情况会触发过渡效果：</strong><br>1 v-if<br>2 v-show<br>3 动态组件（如 component 的 is 属性）<br>4 组件根节点发生变化（如 v-if v-else 切换根节点）</li>
<li><strong>过渡效果 CSS 命名规律：</strong>（name 属性，默认为 v）-（行为：enter、leave、appear、move）-（阶段：无、active、to）</li>
<li><strong>有三种方式来设置过渡样式：</strong><br>1 为 <transition> 标签设定 name 属性。<br>2 在 <transition> 标签中插入 <code>enter-active-class</code> 等设置自定义过渡类名。<br>3 使用 JavaScript 在过渡的<a href="https://cn.vuejs.org/v2/guide/transitions.html#JavaScript-%E9%92%A9%E5%AD%90" target="_blank" rel="noopener">钩子</a>处修改过渡样式。</transition></transition></li>
<li><strong>个人理解：<code>&lt;transition&gt;</code> 标签用于单个元素的进入和离开效果。<code>&lt;transition-group&gt;</code> 标签用于处理如 <code>v-for</code> 遍历这样多个元素的过渡动画。</strong></li>
</ul>
<h1 id="自己实现个过渡方法"><a href="#自己实现个过渡方法" class="headerlink" title="自己实现个过渡方法"></a>自己实现个过渡方法</h1><p>先来两个简单例子理解下 transition（为了节省篇幅和便于查看写在 JSFiddle 中）有兴趣的朋友可以看下~<br><strong>例1：<a href="https://jsfiddle.net/VioletJack/0pnqc99z/1/" target="_blank" rel="noopener">v-enter 和 v-leave 简单实现</a></strong><br><strong>例2：<a href="https://jsfiddle.net/VioletJack/3takx674/" target="_blank" rel="noopener">v-move 简单实现</a></strong></p>
<h1 id="transition-学习"><a href="#transition-学习" class="headerlink" title="transition 学习"></a>transition 学习</h1><h2 id="1-基本原理是什么？"><a href="#1-基本原理是什么？" class="headerlink" title="1. 基本原理是什么？"></a>1. 基本原理是什么？</h2><p>基本原理还是 CSS3 的 <code>transition</code>、<code>transform</code>、<code>animation</code> 这几个属性。用户定义过渡效果，Vue.js 进行处理。下面我们通过 <transition> 过渡的进入的过程看一下：</transition></p>
<ul>
<li>插入元素</li>
<li>解析 <transition> 标签，获取对应的过渡类名。这里默认就 <code>v-</code> 开头了。</transition></li>
<li>为元素定义 v-enter 和 v-enter-active 两个类。<code>class=&quot;v-enter v-enter-active&quot;</code>。</li>
<li>下一帧移除 v-enter，添加 v-enter-to。<code>class=&quot;v-enter-active v-enter-to&quot;</code>。</li>
<li>获取过渡时间，延时执行回调函数。</li>
<li>回调函数中移除 v-enter、v-enter-active 和 v-enter-to 的这些过渡类名，完成过渡。</li>
<li>在整个过程中调用了 <code>beforeEnterHook</code> 、<code>enterHook</code>、<code>afterEnterHook</code>、<code>enterCancelledHook</code> 四个函数，执行相应的<a href="https://cn.vuejs.org/v2/guide/transitions.html#JavaScript-钩子" target="_blank" rel="noopener"> JavaScript 钩子</a>。</li>
</ul>
<p>下面是 <code>enter</code> 函数的代码及注释：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 进入过渡效果</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">enter</span> (<span class="params">vnode: VNodeWithData, toggleDisplay: ?(</span>) =&gt; <span class="title">void</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> el: any = vnode.elm</span><br><span class="line"></span><br><span class="line">  <span class="comment">// call leave callback now 执行 leave 回调函数</span></span><br><span class="line">  <span class="keyword">if</span> (isDef(el._leaveCb)) &#123;</span><br><span class="line">    el._leaveCb.cancelled = <span class="literal">true</span></span><br><span class="line">    el._leaveCb()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 解析 transition 的数据（class、tag、name等）</span></span><br><span class="line">  <span class="keyword">const</span> data = resolveTransition(vnode.data.transition)</span><br><span class="line">  <span class="keyword">if</span> (isUndef(data)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (isDef(el._enterCb) || el.nodeType !== <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    css,</span><br><span class="line">    type,</span><br><span class="line">    enterClass,</span><br><span class="line">    enterToClass,</span><br><span class="line">    enterActiveClass,</span><br><span class="line">    appearClass,</span><br><span class="line">    appearToClass,</span><br><span class="line">    appearActiveClass,</span><br><span class="line">    beforeEnter,</span><br><span class="line">    enter,</span><br><span class="line">    afterEnter,</span><br><span class="line">    enterCancelled,</span><br><span class="line">    beforeAppear,</span><br><span class="line">    appear,</span><br><span class="line">    afterAppear,</span><br><span class="line">    appearCancelled,</span><br><span class="line">    duration</span><br><span class="line">  &#125; = data</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将作为子组件的根节点放置时，我们需要检查 &lt;transition&gt; 的父元素是否出现检查。</span></span><br><span class="line">  <span class="keyword">let</span> context = activeInstance</span><br><span class="line">  <span class="keyword">let</span> transitionNode = activeInstance.$vnode</span><br><span class="line">  <span class="keyword">while</span> (transitionNode &amp;&amp; transitionNode.parent) &#123;</span><br><span class="line">    transitionNode = transitionNode.parent</span><br><span class="line">    context = transitionNode.context</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> isAppear = !context._isMounted || !vnode.isRootInsert</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isAppear &amp;&amp; !appear &amp;&amp; appear !== <span class="string">''</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取进入的 class</span></span><br><span class="line">  <span class="comment">// v-enter</span></span><br><span class="line">  <span class="keyword">const</span> startClass = isAppear &amp;&amp; appearClass</span><br><span class="line">    ? appearClass</span><br><span class="line">    : enterClass</span><br><span class="line">  <span class="comment">// v-enter-active</span></span><br><span class="line">  <span class="keyword">const</span> activeClass = isAppear &amp;&amp; appearActiveClass</span><br><span class="line">    ? appearActiveClass</span><br><span class="line">    : enterActiveClass</span><br><span class="line">  <span class="comment">// v-enter-to</span></span><br><span class="line">  <span class="keyword">const</span> toClass = isAppear &amp;&amp; appearToClass</span><br><span class="line">    ? appearToClass</span><br><span class="line">    : enterToClass</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4个生命周期钩子函数</span></span><br><span class="line">  <span class="keyword">const</span> beforeEnterHook = isAppear</span><br><span class="line">    ? (beforeAppear || beforeEnter)</span><br><span class="line">    : beforeEnter</span><br><span class="line">  <span class="keyword">const</span> enterHook = isAppear</span><br><span class="line">    ? (<span class="keyword">typeof</span> appear === <span class="string">'function'</span> ? appear : enter)</span><br><span class="line">    : enter</span><br><span class="line">  <span class="keyword">const</span> afterEnterHook = isAppear</span><br><span class="line">    ? (afterAppear || afterEnter)</span><br><span class="line">    : afterEnter</span><br><span class="line">  <span class="keyword">const</span> enterCancelledHook = isAppear</span><br><span class="line">    ? (appearCancelled || enterCancelled)</span><br><span class="line">    : enterCancelled</span><br><span class="line"></span><br><span class="line">  <span class="comment">// https://cn.vuejs.org/v2/guide/transitions.html#显性的过渡持续时间</span></span><br><span class="line">  <span class="keyword">const</span> explicitEnterDuration: any = toNumber(</span><br><span class="line">    isObject(duration)</span><br><span class="line">      ? duration.enter</span><br><span class="line">      : duration</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; explicitEnterDuration != <span class="literal">null</span>) &#123;</span><br><span class="line">    checkDuration(explicitEnterDuration, <span class="string">'enter'</span>, vnode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> expectsCSS = css !== <span class="literal">false</span> &amp;&amp; !isIE9</span><br><span class="line">  <span class="keyword">const</span> userWantsControl = getHookArgumentsLength(enterHook)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 完成进入过渡后的回调函数</span></span><br><span class="line">  <span class="keyword">const</span> cb = el._enterCb = once(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (expectsCSS) &#123;</span><br><span class="line">      <span class="comment">// 移除 v-enter-to 和 v-enter-active</span></span><br><span class="line">      removeTransitionClass(el, toClass)</span><br><span class="line">      removeTransitionClass(el, activeClass)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cb.cancelled) &#123;</span><br><span class="line">      <span class="keyword">if</span> (expectsCSS) &#123;</span><br><span class="line">        <span class="comment">// 移除 v-enter</span></span><br><span class="line">        removeTransitionClass(el, startClass)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 调用 enter-cancelled</span></span><br><span class="line">      enterCancelledHook &amp;&amp; enterCancelledHook(el)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      afterEnterHook &amp;&amp; afterEnterHook(el)</span><br><span class="line">    &#125;</span><br><span class="line">    el._enterCb = <span class="literal">null</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!vnode.data.show) &#123;</span><br><span class="line">    <span class="comment">// 通过注入一个 insert 钩子，将待处理的 leave 元素移除。</span></span><br><span class="line">    mergeVNodeHook(vnode, <span class="string">'insert'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> parent = el.parentNode</span><br><span class="line">      <span class="keyword">const</span> pendingNode = parent &amp;&amp; parent._pending &amp;&amp; parent._pending[vnode.key]</span><br><span class="line">      <span class="keyword">if</span> (pendingNode &amp;&amp;</span><br><span class="line">        pendingNode.tag === vnode.tag &amp;&amp;</span><br><span class="line">        pendingNode.elm._leaveCb</span><br><span class="line">      ) &#123;</span><br><span class="line">        pendingNode.elm._leaveCb()</span><br><span class="line">      &#125;</span><br><span class="line">      enterHook &amp;&amp; enterHook(el, cb)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// start enter transition</span></span><br><span class="line">  beforeEnterHook &amp;&amp; beforeEnterHook(el)</span><br><span class="line">  <span class="comment">// 预期 CSS</span></span><br><span class="line">  <span class="keyword">if</span> (expectsCSS) &#123;</span><br><span class="line">    <span class="comment">// 添加 v-enter v-enter-active</span></span><br><span class="line">    addTransitionClass(el, startClass)</span><br><span class="line">    addTransitionClass(el, activeClass)</span><br><span class="line">    <span class="comment">// 下一帧</span></span><br><span class="line">    nextFrame(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 移除 v-enter</span></span><br><span class="line">      removeTransitionClass(el, startClass)</span><br><span class="line">      <span class="keyword">if</span> (!cb.cancelled) &#123;</span><br><span class="line">        <span class="comment">// 添加 v-enter-to</span></span><br><span class="line">        addTransitionClass(el, toClass)</span><br><span class="line">        <span class="keyword">if</span> (!userWantsControl) &#123;</span><br><span class="line">          <span class="comment">// 预期进入时间</span></span><br><span class="line">          <span class="keyword">if</span> (isValidDuration(explicitEnterDuration)) &#123;</span><br><span class="line">            setTimeout(cb, explicitEnterDuration)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 当 transition 结束</span></span><br><span class="line">            whenTransitionEnds(el, type, cb)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (vnode.data.show) &#123;</span><br><span class="line">    toggleDisplay &amp;&amp; toggleDisplay()</span><br><span class="line">    enterHook &amp;&amp; enterHook(el, cb)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!expectsCSS &amp;&amp; !userWantsControl) &#123;</span><br><span class="line">    cb()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="2-过渡的类名和自定义过渡的类名如何用于-中？"><a href="#2-过渡的类名和自定义过渡的类名如何用于-中？" class="headerlink" title="2. 过渡的类名和自定义过渡的类名如何用于  中？"></a>2. <a href="https://cn.vuejs.org/v2/guide/transitions.html#过渡的类名" target="_blank" rel="noopener">过渡的类名</a>和<a href="https://cn.vuejs.org/v2/guide/transitions.html#自定义过渡的类名" target="_blank" rel="noopener">自定义过渡的类名</a>如何用于 <transition> 中？</transition></h2><p>在 <a href="https://cn.vuejs.org/v2/api/#transition" target="_blank" rel="noopener"><transition></transition></a> 中一共有如下属性（props）：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> transitionProps = &#123;</span><br><span class="line">  name: <span class="built_in">String</span>,</span><br><span class="line">  appear: <span class="built_in">Boolean</span>,</span><br><span class="line">  css: <span class="built_in">Boolean</span>,</span><br><span class="line">  mode: <span class="built_in">String</span>,</span><br><span class="line">  type: <span class="built_in">String</span>,</span><br><span class="line">  enterClass: <span class="built_in">String</span>,</span><br><span class="line">  leaveClass: <span class="built_in">String</span>,</span><br><span class="line">  enterToClass: <span class="built_in">String</span>,</span><br><span class="line">  leaveToClass: <span class="built_in">String</span>,</span><br><span class="line">  enterActiveClass: <span class="built_in">String</span>,</span><br><span class="line">  leaveActiveClass: <span class="built_in">String</span>,</span><br><span class="line">  appearClass: <span class="built_in">String</span>,</span><br><span class="line">  appearActiveClass: <span class="built_in">String</span>,</span><br><span class="line">  appearToClass: <span class="built_in">String</span>,</span><br><span class="line">  duration: [<span class="built_in">Number</span>, <span class="built_in">String</span>, <span class="built_in">Object</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到其中就有这些自定义过渡类名，如 enterClass。这些属性如被传入到 <transition> 子组件的 data.transition 对象中。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// extractTransitionData 函数返回组件的所有 propsData 和 listener</span></span><br><span class="line"><span class="keyword">const</span> data: <span class="built_in">Object</span> = (child.data || (child.data = &#123;&#125;)).transition = extractTransitionData(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure></transition></p>
<p>而这个 data.transition 对象在 enter 函数中用到：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = resolveTransition(vnode.data.transition)</span><br></pre></td></tr></table></figure></p>
<p><code>resolveTransition</code> 函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 解析 transition 过渡 CSS</span><br><span class="line">export function resolveTransition (def?: string | Object): ?Object &#123;</span><br><span class="line">  if (!def) &#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  // 合并过渡类名和自定义过渡类名</span><br><span class="line">  if (typeof def === &apos;object&apos;) &#123;</span><br><span class="line">    const res = &#123;&#125;</span><br><span class="line">    if (def.css !== false) &#123;</span><br><span class="line">      // 使用 name，默认为 v</span><br><span class="line">      extend(res, autoCssTransition(def.name || &apos;v&apos;))</span><br><span class="line">    &#125;</span><br><span class="line">    extend(res, def)</span><br><span class="line">    return res</span><br><span class="line">  &#125; else if (typeof def === &apos;string&apos;) &#123;</span><br><span class="line">    return autoCssTransition(def)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 通过 name 属性获取过渡 CSS 类名</span><br><span class="line">const autoCssTransition: (name: string) =&gt; Object = cached(name =&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    enterClass: `$&#123;name&#125;-enter`,</span><br><span class="line">    enterToClass: `$&#123;name&#125;-enter-to`,</span><br><span class="line">    enterActiveClass: `$&#123;name&#125;-enter-active`,</span><br><span class="line">    leaveClass: `$&#123;name&#125;-leave`,</span><br><span class="line">    leaveToClass: `$&#123;name&#125;-leave-to`,</span><br><span class="line">    leaveActiveClass: `$&#123;name&#125;-leave-active`</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>resolveTransition 函数合并了过渡类名和自定义过渡类名，返回最终的过渡类名。之后就是使用这些类名来实现过渡动画。<br><em>PS：从源码中可以知道自定义过渡类名要优先于 name 定义的过渡类名。</em><br>小结一下就是：<strong>Vue.js 通过 <transition> 的 props 获取自定义过渡类名，通过 <transition> 的 name 属性解析获取过渡类名，两者合并成为最终过渡类名，用以实现过渡效果。</transition></transition></strong></p>
<h2 id="3-JavaScript-钩子如何实现？"><a href="#3-JavaScript-钩子如何实现？" class="headerlink" title="3. JavaScript 钩子如何实现？"></a>3. JavaScript 钩子如何实现？</h2><p>从 <code>enter</code> 函数中可以知道，在特定时间点会调用指定 JavaScript 钩子函数，所以我们只需绑定好函数即可按时间点触发。像这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enterHook &amp;&amp; enterHook(el, cb)</span><br></pre></td></tr></table></figure></p>
<h2 id="4-transition-组件和-transition-group-标签的基本原理是什么？"><a href="#4-transition-组件和-transition-group-标签的基本原理是什么？" class="headerlink" title="4. transition 组件和 transition-group 标签的基本原理是什么？"></a>4. transition 组件和 transition-group 标签的基本原理是什么？</h2><p>其实就是 Vue.js 的组件，在其中实现了过渡效果而已。<br>transition 中只能包含一个子元素，标签通过 render 函数来渲染子元素（不渲染自身，所以我们在 DOM 中看不到 transition 节点）。主要用于控制元素的进入和离开，当元素离开后元素就从 DOM 中移除了。<br>transition-group 可以包含多个子元素，也是用 render 函数，渲染为指定标签名的元素。相比 transition 多了一个 v-move 属性用于控制多个组件间的移动速度。</p>
<h2 id="5-v-if、v-show、component-等组件变化如何监听？"><a href="#5-v-if、v-show、component-等组件变化如何监听？" class="headerlink" title="5. v-if、v-show、component 等组件变化如何监听？"></a>5. v-if、v-show、component 等组件变化如何监听？</h2><p>在使用 v-if、v-else 和 component 切换组件的时候，v-if、v-else 需要传入 key 以区分相同标签的不同元素。而 component 标签不需要。在代码中会解析 key 和 component 名组成新的 key，所以两个不同的 component 也会拥有不同的 key 实现切换效果。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> id = <span class="string">"__transition-"</span> + (<span class="keyword">this</span>._uid) + <span class="string">"-"</span>;</span><br><span class="line">child.key = child.key == <span class="literal">null</span></span><br><span class="line">  ? child.isComment</span><br><span class="line">    ? id + <span class="string">'comment'</span></span><br><span class="line">    : id + child.tag</span><br><span class="line">  : isPrimitive(child.key)</span><br><span class="line">    ? (<span class="built_in">String</span>(child.key).indexOf(id) === <span class="number">0</span> ? child.key : id + child.key)</span><br><span class="line">    : child.key;</span><br></pre></td></tr></table></figure></p>
<p>而对于 v-show，做了特殊标记 —— 当有 v-show 指令时标记 child.data.show 为 true：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (child.data.directives &amp;&amp; child.data.directives.some(<span class="function"><span class="params">d</span> =&gt;</span> d.name === <span class="string">'show'</span>)) &#123;</span><br><span class="line">  child.data.show = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>之后再过渡的逻辑中对 v-show 做了些处理，实现过渡效果。<br>同时，在 <code>v-show</code> 的源码 <code>src/platforms/web/runtime/directives/show.js</code> 中对于 transition 也做了一些处理。比如在 update 方法中获取 transition，如果有过渡则 v-show 使用过渡效果，否则使用 <code>style.display</code> 来隐藏元素。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">update (el: any, &#123; value, oldValue &#125;: VNodeDirective, <span class="attr">vnode</span>: VNodeWithData) &#123;</span><br><span class="line">  <span class="keyword">if</span> (value === oldValue) <span class="keyword">return</span></span><br><span class="line">  vnode = locateNode(vnode)</span><br><span class="line">  <span class="comment">// 过渡效果</span></span><br><span class="line">  <span class="keyword">const</span> transition = vnode.data &amp;&amp; vnode.data.transition</span><br><span class="line">  <span class="keyword">if</span> (transition) &#123;</span><br><span class="line">    vnode.data.show = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      enter(vnode, () =&gt; &#123;</span><br><span class="line">        el.style.display = el.__vOriginalDisplay</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      leave(vnode, () =&gt; &#123;</span><br><span class="line">        el.style.display = <span class="string">'none'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 隐藏</span></span><br><span class="line">    el.style.display = value ? el.__vOriginalDisplay : <span class="string">'none'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h2 id="6-transition-中两个相同标签的组件为何要用-key-分开？"><a href="#6-transition-中两个相同标签的组件为何要用-key-分开？" class="headerlink" title="6. transition 中两个相同标签的组件为何要用 key 分开？"></a>6. transition 中两个相同标签的组件为何要用 key 分开？</h2><p>使用 key 和 tagName 来判断是否为同一个节点。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isSameChild</span> (<span class="params">child: VNode, oldChild: VNode</span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> oldChild.key === child.key &amp;&amp; oldChild.tag === child.tag</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="8-过渡逻辑和过渡组件如何作用于一起"><a href="#8-过渡逻辑和过渡组件如何作用于一起" class="headerlink" title="8. 过渡逻辑和过渡组件如何作用于一起"></a>8. 过渡逻辑和过渡组件如何作用于一起</h2><p>在源码中有四个过渡相关的源码：</p>
<ul>
<li><code>src/platforms/web/runtime/components/transition.js</code> <transition> 组件源码。</transition></li>
<li><code>src/platforms/web/runtime/components/transition-group.js</code> <transition-group> 组件源码</transition-group></li>
<li><code>src/platforms/web/runtime/transition-util.js</code> 过渡工具代码。</li>
<li><code>src/platforms/web/runtime/modules/transition.js</code> 过渡逻辑代码。</li>
</ul>
<p>前三个很好理解，最后一个 transition.js 其实是在 patch 方法中和 v-show 中使用的~<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/platforms/web/runtime/directives/show.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; enter, leave &#125; <span class="keyword">from</span> <span class="string">'../modules/transition'</span></span><br></pre></td></tr></table></figure></p>
<p>v-show 中调用了 transition 的 enter 和 leave 函数，在 v-show 作用于过渡效果时调用。<br>另外一个使用的地方比较隐蔽，先来看看 transition.js 导出的内容：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/platforms/web/runtime/modules/transition.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_enter</span> (<span class="params">_: any, vnode: VNodeWithData</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (vnode.data.show !== <span class="literal">true</span>) &#123;</span><br><span class="line">    enter(vnode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> inBrowser ? &#123;</span><br><span class="line">  create: _enter,</span><br><span class="line">  activate: _enter,</span><br><span class="line">  remove (vnode: VNode, <span class="attr">rm</span>: <span class="built_in">Function</span>) &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (vnode.data.show !== <span class="literal">true</span>) &#123;</span><br><span class="line">      leave(vnode, rm)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      rm()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; : &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里讲 enter 和 leave 函数在方法中使用并导出（如果是浏览器的话）。继续往下找：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/platforms/web/runtime/modules/index.js</span></span><br><span class="line"><span class="keyword">import</span> transition <span class="keyword">from</span> <span class="string">'./transition'</span></span><br></pre></td></tr></table></figure></p>
<p>导入到 modules 文件夹 index.js，index.js 在 patch.js 中使用了。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/platforms/web/runtime/patch.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> nodeOps <span class="keyword">from</span> <span class="string">'web/runtime/node-ops'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPatchFunction &#125; <span class="keyword">from</span> <span class="string">'core/vdom/patch'</span></span><br><span class="line"><span class="keyword">import</span> baseModules <span class="keyword">from</span> <span class="string">'core/vdom/modules/index'</span></span><br><span class="line"><span class="keyword">import</span> platformModules <span class="keyword">from</span> <span class="string">'web/runtime/modules/index'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> modules = platformModules.concat(baseModules)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> patch: <span class="built_in">Function</span> = createPatchFunction(&#123; nodeOps, modules &#125;)</span><br></pre></td></tr></table></figure></p>
<p>在此处合并 modules，并且创建了 patch 方法。这个 patch 方法在之前写的<a href="https://www.jianshu.com/p/9db8eb16d76f" target="_blank" rel="noopener">Vue.js 源码学习六 —— VNode虚拟DOM学习</a>中提到过，用于对比虚拟 DOM，实现差异化更新。<br>可以看下 modules 在 createPatchFunction 方法中做了些什么？<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hooks = [<span class="string">'create'</span>, <span class="string">'activate'</span>, <span class="string">'update'</span>, <span class="string">'remove'</span>, <span class="string">'destroy'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createPatchFunction</span> (<span class="params">backend</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i, j</span><br><span class="line">  <span class="keyword">const</span> cbs = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; modules, nodeOps &#125; = backend</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; hooks.length; ++i) &#123;</span><br><span class="line">    cbs[hooks[i]] = []</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; modules.length; ++j) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isDef(modules[j][hooks[i]])) &#123;</span><br><span class="line">        cbs[hooks[i]].push(modules[j][hooks[i]])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里可以发现 transition.js 中导出的 create、activate 和 remove 方法都是 patch 的生命周期函数。也就是说当元素创建、激活、移除行为时就会执行 transition.js 中的逻辑，而 <transition> 和 <transition-group> 组件都会有组件的这些行为。Vue.js 很巧妙的将组件相关行为都交给了 patch 的生命周期去处理，学习了！</transition-group></transition></p>
<h2 id="8-过渡模式-mode-的实现原理是啥"><a href="#8-过渡模式-mode-的实现原理是啥" class="headerlink" title="8. 过渡模式 mode 的实现原理是啥"></a>8. 过渡模式 mode 的实现原理是啥</h2><p>在 <transition> 组件的 render 函数中有这么一段：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 控制离开/进入的过渡时间序列。有效的模式有 "out-in" 和 "in-out"；默认同时生效。</span></span><br><span class="line"><span class="keyword">if</span> (mode === <span class="string">'out-in'</span>) &#123;</span><br><span class="line">  <span class="comment">// return placeholder node and queue update when leave finishes</span></span><br><span class="line">  <span class="keyword">this</span>._leaving = <span class="literal">true</span></span><br><span class="line">  mergeVNodeHook(oldData, <span class="string">'afterLeave'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">this</span>._leaving = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.$forceUpdate()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> placeholder(h, rawChild)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mode === <span class="string">'in-out'</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isAsyncPlaceholder(child)) &#123;</span><br><span class="line">    <span class="keyword">return</span> oldRawChild</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> delayedLeave</span><br><span class="line">  <span class="keyword">const</span> performLeave = <span class="function"><span class="params">()</span> =&gt;</span> &#123; delayedLeave() &#125;</span><br><span class="line">  mergeVNodeHook(data, <span class="string">'afterEnter'</span>, performLeave)</span><br><span class="line">  mergeVNodeHook(data, <span class="string">'enterCancelled'</span>, performLeave)</span><br><span class="line">  mergeVNodeHook(oldData, <span class="string">'delayLeave'</span>, leave =&gt; &#123; delayedLeave = leave &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></transition></p>
<p>这里就是 mode 的实现代码了，先看看两种 mode 的用法</p>
<blockquote>
<ul>
<li>in-out：新元素先进行过渡，完成之后当前元素过渡离开。</li>
<li>out-in：当前元素先进行过渡，完成之后新元素过渡进入。</li>
</ul>
</blockquote>
<p>可以看到，在 out-in 逻辑中，当切换元素时，先不渲染第二个组件而是返回，之后才会返回 placeholder 函数结果，当第一个元素完全 leave 后加载第二个元素。而在 in-out 元素中做的是将第一个元素延时到第二个元素 enter 后再 leave。</p>
<h2 id="9-的-v-move-重新排序一组内容，如何实现的移动变化？"><a href="#9-的-v-move-重新排序一组内容，如何实现的移动变化？" class="headerlink" title="9.  的 v-move 重新排序一组内容，如何实现的移动变化？"></a>9. <transition-group> 的 v-move 重新排序一组内容，如何实现的移动变化？</transition-group></h2><p>比如我们有一个 1-5 的数组使用 v-for 遍历显示到 transition-group 中，当数组发生变化时，会做如下操作：</p>
<ul>
<li>初始数组 <code>[ 1, 2, 3, 4, 5 ]</code></li>
<li>数组发生变化 <code>[ 1, 4, 3, 2, 5 ]</code></li>
<li>在 render 函数中记录变化前后额数组 preChildren 和 children 两个 VNode 数组。</li>
<li>在 render 函数中使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect" target="_blank" rel="noopener">getBoundingClientRect()</a> 方法记录变化前每个元素的位置 oldPos。</li>
<li>获取要保留和移除的元素数组。</li>
<li>渲染变化后的数组元素。</li>
<li>在 beforeUpdate 方法中使用 patch 方法移除要移除的元素。</li>
<li>进入 Updated 方法中，注意此时渲染结果已经是新数组 <code>[ 1, 4, 3, 2, 5 ]</code> 了。</li>
<li>获取过渡类名和子元素数组 children。</li>
<li>遍历调用<ul>
<li>执行回调函数</li>
<li>计算当前各元素位置 newPos</li>
<li>根据 oldPos 和 newPos，使用内联样式 <code>translate(${dx}px,${dy}px)</code> 将元素移动到之前的位置，看着就像是  <code>[ 1, 2, 3, 4, 5 ]</code></li>
</ul>
</li>
<li>最后遍历元素，添加 moveClass 类名，移除 <code>translate(${dx}px,${dy}px)</code> 内联样式。绑定 <a href="https://developer.mozilla.org/en-US/docs/Web/Events/transitionend" target="_blank" rel="noopener">transitionend</a> 事件。</li>
</ul>
<p>代码太长，就不多贴了~可以<strong><a href="https://github.com/violetjack/VueStudyDemos/blob/master/VueCodes/vue/src/platforms/web/runtime/components/transition-group.js" target="_blank" rel="noopener">点击这里</a></strong>跳转查看。<strong>总结下来就是先改变元素，然后把元素移动成之前的样子，然后使用过渡类名定义过渡时间实现过渡效果。</strong><br>v-move 的关键就是“假装元素位置没变”的行为。让我们看上去像是慢慢移动的。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyTranslation</span> (<span class="params">c: VNode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> oldPos = c.data.pos</span><br><span class="line">  <span class="keyword">const</span> newPos = c.data.newPos</span><br><span class="line">  <span class="keyword">const</span> dx = oldPos.left - newPos.left</span><br><span class="line">  <span class="keyword">const</span> dy = oldPos.top - newPos.top</span><br><span class="line">  <span class="keyword">if</span> (dx || dy) &#123;</span><br><span class="line">    <span class="comment">// 定义 0 秒的 translate 内联样式把元素移动到原来的样子</span></span><br><span class="line">    c.data.moved = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">const</span> s = c.elm.style</span><br><span class="line">    s.transform = s.WebkitTransform = <span class="string">`translate(<span class="subst">$&#123;dx&#125;</span>px,<span class="subst">$&#123;dy&#125;</span>px)`</span></span><br><span class="line">    s.transitionDuration = <span class="string">'0s'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="10-vue-的-transition-和-CSS3-的-transition-有何不同？"><a href="#10-vue-的-transition-和-CSS3-的-transition-有何不同？" class="headerlink" title="10. vue 的 transition 和 CSS3 的 transition 有何不同？"></a>10. vue 的 transition 和 CSS3 的 transition 有何不同？</h2><p>基本原理都是使用了 CSS3 的 transition，但是 Vue 的 transition 组件是配合着 VDOM 来写的、同时提供了过渡各阶段效果的 CSS 和 JS 控制，便于我们快捷、精确、安全地实现一些简单或复杂的过渡效果。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>原本只是想看看 transition 如何实现，却扯出这么一堆问题。其中关于 transition 和 transition-group 组件讲的有点草率，有兴趣可以再深入学习下~<br>从本次学习中我学到了：</p>
<ul>
<li>更加优雅高效的 JS 逻辑写法（patch 中的生命周期统一处理 DOM 操作中的逻辑）</li>
<li>更加熟悉 CSS3 的 transition 过渡属性。</li>
<li>解决了我对 transition 的各种疑问。</li>
</ul>
<p>OK，关于 Vue 的过渡效果就聊到这儿了，写了三天……我得去休息休息了 0.0</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/04/03/element 源码学习五 —— Notice 系列组件学习/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/03/element 源码学习五 —— Notice 系列组件学习/" class="post-title-link" itemprop="url">element 源码学习五 —— Notice 系列组件学习</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-04-03 00:00:00" itemprop="dateCreated datePublished" datetime="2018-04-03T00:00:00+08:00">2018-04-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2019-02-16 01:20:56" itemprop="dateModified" datetime="2019-02-16T01:20:56+08:00">2019-02-16</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>消息提示行为是开发中非常常见的功能，Element 为我们提供了非常好用和美观的消息提示组件。这里就简单学习下 Notice 组件的 CSS 和代码逻辑。</p>
</blockquote>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Notice 包括了五类组件：</p>
<ul>
<li><strong>Alert</strong> 用于页面中展示重要的提示信息。</li>
<li><strong>Loading</strong> 加载数据时显示动效。</li>
<li><strong>Message</strong> 常用于主动操作后的反馈提示。与 Notification 的区别是后者更多用于系统级通知的被动提醒。</li>
<li><strong>MessageBox</strong> 模拟系统的消息提示框而实现的一套模态对话框组件，用于消息提示、确认消息和提交内容。</li>
<li><strong>Notification</strong> 悬浮出现在页面角落，显示全局的通知提醒消息。</li>
</ul>
<p>本文中不同角度来学习这些组件（这些组件有很多相似性，所以一起学习啦~）。</p>
<h1 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h1><p>下面是参照 element ui 写的一个小demo，尝试着了解下其中的 CSS<br>贴代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>My Notice<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.success-color</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#f0f9eb</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#67c23a</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.info-color</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#f4f4f5</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#909399</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.warning-color</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#fdf6ec</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#e6a23c</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.error-color</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#fef0f0</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#f56c6c</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.alert-container</span> &#123;</span></span><br><span class="line"><span class="undefined">            position: relative;</span></span><br><span class="line"><span class="undefined">            padding: 8px 16px;</span></span><br><span class="line"><span class="undefined">            border-radius: 5px;</span></span><br><span class="line"><span class="undefined">            opacity: 1;</span></span><br><span class="line"><span class="undefined">            align-items: center;</span></span><br><span class="line"><span class="undefined">            overflow: hidden;</span></span><br><span class="line"><span class="undefined">            display: flex;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.success-text</span> &#123;</span></span><br><span class="line"><span class="undefined">            font-size: 13px;</span></span><br><span class="line"><span class="undefined">            line-height: 18px;</span></span><br><span class="line"><span class="undefined">            padding: 0 8px;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#67c23a</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.close</span> &#123;</span></span><br><span class="line"><span class="undefined">            font-size: 13px;</span></span><br><span class="line"><span class="undefined">            position: absolute;</span></span><br><span class="line"><span class="undefined">            top: 12px;</span></span><br><span class="line"><span class="undefined">            right: 15px;</span></span><br><span class="line"><span class="undefined">            cursor: pointer;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.loading-background</span> &#123;</span></span><br><span class="line"><span class="undefined">            position: fixed;</span></span><br><span class="line"><span class="undefined">            z-index: 2000;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-tag">rgba</span>(26, 26, 26, 0<span class="selector-class">.9</span>);</span></span><br><span class="line"><span class="undefined">            margin: 0;</span></span><br><span class="line"><span class="undefined">            top: 0;</span></span><br><span class="line"><span class="undefined">            right: 0;</span></span><br><span class="line"><span class="undefined">            bottom: 0;</span></span><br><span class="line"><span class="undefined">            left: 0;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">transition</span>: <span class="selector-tag">opacity</span> 0<span class="selector-class">.3s</span>;</span></span><br><span class="line"><span class="undefined">            z-index: 2000;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.loading-div</span> &#123;</span></span><br><span class="line"><span class="undefined">            top: 50%;</span></span><br><span class="line"><span class="undefined">            position: absolute;</span></span><br><span class="line"><span class="undefined">            margin-top: -20px;</span></span><br><span class="line"><span class="undefined">            height: 40px;</span></span><br><span class="line"><span class="undefined">            width: 100%;</span></span><br><span class="line"><span class="undefined">            align-items: center;</span></span><br><span class="line"><span class="undefined">            justify-content: center;</span></span><br><span class="line"><span class="undefined">            display: flex;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.loading-text</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#f0f9eb</span>;</span></span><br><span class="line"><span class="undefined">            font-size: 15px;</span></span><br><span class="line"><span class="undefined">            overflow: hidden;</span></span><br><span class="line"><span class="undefined">            z-index: 2001;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.el-message</span> &#123;</span></span><br><span class="line"><span class="undefined">            min-width: 380px;</span></span><br><span class="line"><span class="undefined">            box-sizing: border-box;</span></span><br><span class="line"><span class="undefined">            border-radius: 4px;</span></span><br><span class="line"><span class="undefined">            border-width: 1px;</span></span><br><span class="line"><span class="undefined">            border-style: solid;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border-color</span>: <span class="selector-id">#ebeef5</span>;</span></span><br><span class="line"><span class="undefined">            position: fixed;</span></span><br><span class="line"><span class="undefined">            left: 50%;</span></span><br><span class="line"><span class="undefined">            top: 20px;</span></span><br><span class="line"><span class="undefined">            transform: translateX(-50%);</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#edf2fc</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">transition</span>: <span class="selector-tag">opacity</span> 0<span class="selector-class">.3s</span>, <span class="selector-tag">transform</span> 0<span class="selector-class">.4s</span>;</span></span><br><span class="line"><span class="undefined">            overflow: hidden;</span></span><br><span class="line"><span class="undefined">            padding: 15px 15px 15px 20px;</span></span><br><span class="line"><span class="undefined">            display: flex;</span></span><br><span class="line"><span class="undefined">            align-items: center;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert-container success-color"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"success-text"</span>&gt;</span>成功提示的文案<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"close"</span>&gt;</span>X<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"showLoading"</span>&gt;</span>显示加载中<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"showMessage"</span>&gt;</span>显示信息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"el-message"</span> <span class="attr">id</span>=<span class="string">"message"</span> <span class="attr">style</span>=<span class="string">"display:none;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一条消息<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> alertContainer = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"alert-container"</span>)[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> close = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"close"</span>)[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">        close.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alertContainer.style = <span class="string">"display:none;"</span></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> app = <span class="built_in">document</span>.getElementById(<span class="string">"app"</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> bg = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>)</span></span><br><span class="line"><span class="javascript">        bg.className = <span class="string">"loading-background"</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>)</span></span><br><span class="line"><span class="javascript">        div.className = <span class="string">"loading-div"</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> text = <span class="built_in">document</span>.createElement(<span class="string">"span"</span>)</span></span><br><span class="line"><span class="javascript">        text.className = <span class="string">"loading-text"</span></span></span><br><span class="line"><span class="javascript">        text.textContent = <span class="string">"加载中……"</span></span></span><br><span class="line"><span class="undefined">        div.appendChild(text)</span></span><br><span class="line"><span class="undefined">        bg.appendChild(div)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">"showLoading"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (<span class="built_in">document</span>.getElementsByClassName(<span class="string">"loading-background"</span>).length &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            app.appendChild(bg)</span></span><br><span class="line"><span class="javascript">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (<span class="built_in">document</span>.getElementsByClassName(<span class="string">"loading-background"</span>).length &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="undefined">                    app.removeChild(bg)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;, 3000)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">"showMessage"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">"message"</span>).style = <span class="string">"display:block;"</span></span></span><br><span class="line"><span class="javascript">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.getElementById(<span class="string">"message"</span>).style = <span class="string">"display:none;"</span></span></span><br><span class="line"><span class="undefined">            &#125;, 3000)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>代码的运行结果请看 <strong><a href="https://jsfiddle.net/VioletJack/h28fnfds/2/" target="_blank" rel="noopener">-&gt;这里&lt;-</a></strong>！</p>
<p>以上代码实现了</p>
<ul>
<li>Alert 的样式</li>
<li>loading 的简单版本 </li>
<li>message 的无动画版本。</li>
</ul>
<p>只实现这三个功能的原因是另外两个功能和扩展功能都是基于这个demo扩展的。<br>Alert 是一个静态的文本内容，只是外部包裹了带样式的容器。可能再多个隐藏按钮和消息图标。<br>Loading 和 MessageBox 其实的基本逻辑是插入或显示新的内容，并在显示完成后消失。需要注意的就是后面要添加一层遮罩阴影，遮罩如果非全屏使用 position:absolute 而全屏则使用 position:fixed 覆盖。另外就是注意 z-index 属性将组件放到视图最上层。<br>Message 和 Notification 其实就是文本内容、图标和按钮组合容器的现实和隐藏过程。它们的过渡动画使用的是 vue 的<a href="https://cn.vuejs.org/v2/guide/transitions.html" target="_blank" rel="noopener">进入/离开 &amp; 列表过渡</a>来实现。</p>
<h1 id="通过几个问题来看源码"><a href="#通过几个问题来看源码" class="headerlink" title="通过几个问题来看源码"></a>通过几个问题来看源码</h1><p>其实从样式上，上面的 demo 已经实现了大致的样子了。下面来看看组件的一些逻辑。源码内容比较多，所以就以问答的方式有目的的来看源码。</p>
<h2 id="Alert-的界面实现？"><a href="#Alert-的界面实现？" class="headerlink" title="Alert 的界面实现？"></a>Alert 的界面实现？</h2><p>Alert 由图标、文本内容、描述内容和关闭按钮组成：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">"el-alert-fade"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"el-alert"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:class</span>=<span class="string">"[typeClass, center ? 'is-center' : '']"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-show</span>=<span class="string">"visible"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">role</span>=<span class="string">"alert"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 图标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-alert__icon"</span> <span class="attr">:class</span>=<span class="string">"[ iconClass, isBigIcon ]"</span> <span class="attr">v-if</span>=<span class="string">"showIcon"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"el-alert__content"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 标题 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"el-alert__title"</span> <span class="attr">:class</span>=<span class="string">"[ isBoldTitle ]"</span> <span class="attr">v-if</span>=<span class="string">"title"</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 插槽，默认插入描述文本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"el-alert__description"</span> <span class="attr">v-if</span>=<span class="string">"description"</span>&gt;</span>&#123;&#123; description &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 关闭图标按钮 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-alert__closebtn"</span> <span class="attr">:class</span>=<span class="string">"&#123; 'is-customed': closeText !== '', 'el-icon-close': closeText === '' &#125;"</span> <span class="attr">v-show</span>=<span class="string">"closable"</span> @<span class="attr">click</span>=<span class="string">"close()"</span>&gt;</span>&#123;&#123;closeText&#125;&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>组件很简单，注释上都写了~组件还做了 <code>slot</code> 插槽拓展，可以在 <code>&lt;el-alert&gt;</code> 标签内插入自定义内容。</p>
<h2 id="如何显示纯文本、HTML-和-VNode"><a href="#如何显示纯文本、HTML-和-VNode" class="headerlink" title="如何显示纯文本、HTML 和 VNode"></a>如何显示纯文本、HTML 和 VNode</h2><p>显示文本使用 <code></code> 指令来显示内容。<br>显示HTML使用 <code>v-html</code> 指令来渲染显示。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 显示文本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">"!dangerouslyUseHTMLString"</span> <span class="attr">class</span>=<span class="string">"el-message__content"</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 显示HTML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span> <span class="attr">v-html</span>=<span class="string">"message"</span> <span class="attr">class</span>=<span class="string">"el-message__content"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>使用 vue 的 render 函数生成 VNode 对象传给组件作为组件 <code>slot</code> 插槽的默认显示结果。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isVNode(instance.message)) &#123;</span><br><span class="line">  instance.$slots.default = [instance.message];</span><br><span class="line">  instance.message = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="组件的过渡动画怎么来的"><a href="#组件的过渡动画怎么来的" class="headerlink" title="组件的过渡动画怎么来的"></a>组件的过渡动画怎么来的</h2><p>使用 Notice 系列组件时，发现组件的显示和消失都是有过渡动画的。界面看着更加友好和舒服。实现方式就是使用了 vue 的<a href="https://cn.vuejs.org/v2/guide/transitions.html" target="_blank" rel="noopener">进入/离开 &amp; 列表过渡</a>来实现效果。</p>
<h2 id="界面的关闭使用的是什么方式？"><a href="#界面的关闭使用的是什么方式？" class="headerlink" title="界面的关闭使用的是什么方式？"></a>界面的关闭使用的是什么方式？</h2><p>对于 loading 和 message-box ，在没有界面时会在 body 最后添加组件内容，显示过后使用 <code>v-show=&quot;false&quot;</code>(<code>display:none;</code>) 隐藏，随后就调用显示和隐藏界面。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 message-box 组件加入到 body 中</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(instance.$el);</span><br></pre></td></tr></table></figure></p>
<p>对于 Alert 由于一开始就显示，只是删除按钮，所以只需修改 <code>v-show</code> 属性隐藏即可。<br>对于 message 和 notification，这两个组件可以多次弹出，逐个关闭（自动或手动）。所以这两个组件是保存在一个数组中，然后进行渲染的，关闭某个组件就是一个将组件从组件数组中移除的过程。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// id 组件id</span></span><br><span class="line"><span class="comment">// useOnClose 自定义关闭函数</span></span><br><span class="line">Message.close = <span class="function"><span class="keyword">function</span>(<span class="params">id, userOnClose</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = instances.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (id === instances[i].id) &#123;</span><br><span class="line">      <span class="comment">// 找到组件，执行自定义关闭函数并从数组中移除</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> userOnClose === <span class="string">'function'</span>) &#123;</span><br><span class="line">        userOnClose(instances[i]);</span><br><span class="line">      &#125;</span><br><span class="line">      instances.splice(i, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="message-box-的回调函数实现"><a href="#message-box-的回调函数实现" class="headerlink" title="message-box 的回调函数实现"></a>message-box 的回调函数实现</h2><p>对于 message-box 有两种函数回调：callback 函数和 Promise 函数。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">Promise</span> !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    msgQueue.push(&#123;</span><br><span class="line">      options: merge(&#123;&#125;, defaults, MessageBox.defaults, options),</span><br><span class="line">      callback: callback,</span><br><span class="line">      resolve: resolve,</span><br><span class="line">      reject: reject</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    showNextMsg();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  msgQueue.push(&#123;</span><br><span class="line">    options: merge(&#123;&#125;, defaults, MessageBox.defaults, options),</span><br><span class="line">    callback: callback</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  showNextMsg();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当然，到这一步只是将组件配置和回调函数组成对象，并没有执行。执行实在 <code>showNextMsg</code> 方法中。<code>showNextMsg</code> 方法用于组合当前组件 <code>options</code> 并写入到 DOM 中，然后显示组件。其中有这么一段关于回调的：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果 currentMsg.options.callback 为 undefined</span></span><br><span class="line"><span class="keyword">if</span> (options.callback === <span class="literal">undefined</span>) &#123;</span><br><span class="line">  instance.callback = defaultCallback;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>所以再看看 <code>defaultCallback</code> 函数对象：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultCallback = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (currentMsg) &#123;</span><br><span class="line">    <span class="keyword">let</span> callback = currentMsg.callback;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> callback === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (instance.showInput) &#123;</span><br><span class="line">        callback(instance.inputValue, action);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback(action);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (currentMsg.resolve) &#123;</span><br><span class="line">      <span class="keyword">if</span> (action === <span class="string">'confirm'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance.showInput) &#123;</span><br><span class="line">          currentMsg.resolve(&#123; <span class="attr">value</span>: instance.inputValue, action &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          currentMsg.resolve(action);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action === <span class="string">'cancel'</span> &amp;&amp; currentMsg.reject) &#123;</span><br><span class="line">        currentMsg.reject(action);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这里就可以看到回调函数和 Promise 的调用和传参过程。当组件“关闭”的时候执行 callback 方法回调：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">doClose() &#123;</span><br><span class="line">  ……</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.action) <span class="keyword">this</span>.callback(<span class="keyword">this</span>.action, <span class="keyword">this</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>至此实现了回调及其传参。</p>
<h2 id="如何实现显示多个-Notification-向下偏移插入？"><a href="#如何实现显示多个-Notification-向下偏移插入？" class="headerlink" title="如何实现显示多个 Notification 向下偏移插入？"></a>如何实现显示多个 Notification 向下偏移插入？</h2><p>偏移量计算在 Notification 的构造方法中计算获得当前组件 <code>verticalOffset</code>。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Notification = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 服务器渲染</span></span><br><span class="line">  <span class="keyword">if</span> (Vue.prototype.$isServer) <span class="keyword">return</span>;</span><br><span class="line">  options = options || &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> userOnClose = options.onClose; <span class="comment">// 自定义关闭</span></span><br><span class="line">  <span class="keyword">const</span> id = <span class="string">'notification_'</span> + seed++; <span class="comment">// 组件 id</span></span><br><span class="line">  <span class="keyword">const</span> position = options.position || <span class="string">'top-right'</span>; <span class="comment">// 位置</span></span><br><span class="line">  <span class="comment">// 关闭事件</span></span><br><span class="line">  options.onClose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Notification.close(id, userOnClose);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 组件实例</span></span><br><span class="line">  instance = <span class="keyword">new</span> NotificationConstructor(&#123;</span><br><span class="line">    data: options</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// vnode</span></span><br><span class="line">  <span class="keyword">if</span> (isVNode(options.message)) &#123;</span><br><span class="line">    instance.$slots.default = [options.message];</span><br><span class="line">    options.message = <span class="string">'REPLACED_BY_VNODE'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  instance.id = id;</span><br><span class="line">  instance.vm = instance.$mount();</span><br><span class="line">  <span class="comment">// 添加实例</span></span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(instance.vm.$el);</span><br><span class="line">  instance.vm.visible = <span class="literal">true</span>;</span><br><span class="line">  instance.dom = instance.vm.$el;</span><br><span class="line">  instance.dom.style.zIndex = PopupManager.nextZIndex();</span><br><span class="line">  <span class="comment">// 偏移量计算</span></span><br><span class="line">  <span class="keyword">let</span> verticalOffset = options.offset || <span class="number">0</span>;</span><br><span class="line">  instances.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.position === position).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    verticalOffset += item.$el.offsetHeight + <span class="number">16</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  verticalOffset += <span class="number">16</span>;</span><br><span class="line">  instance.verticalOffset = verticalOffset;</span><br><span class="line">  <span class="comment">// 传入数组</span></span><br><span class="line">  instances.push(instance);</span><br><span class="line">  <span class="keyword">return</span> instance.vm;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>偏移量 <code>verticalOffset</code> 在组件 <code>package\notification/src/main.vue</code> 中使用。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">"positionStyle"</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="comment">// 正则匹配 position 是 top 还是 bottom</span></span><br><span class="line">  verticalProperty() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^top-/</span>.test(<span class="keyword">this</span>.position) ? <span class="string">'top'</span> : <span class="string">'bottom'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 最后返回的内联样式</span></span><br><span class="line">  positionStyle() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      [<span class="keyword">this</span>.verticalProperty]: <span class="string">`<span class="subst">$&#123; <span class="keyword">this</span>.verticalOffset &#125;</span>px`</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果 <code>position</code> 是 <code>bottom-left</code> 偏移量 <code>verticalOffset</code> 为 20，那么返回的内联样式就是：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>至此实现了偏移的功能。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>这里简单学习了一下 Notice 系列组件的样式和逻辑。从中学到了：</p>
<ul>
<li>用 CSS 设计样式和动态修改样式属性。</li>
<li>用了许多 DOM 的操作</li>
<li>使用已有轮子 —— 用到了 Vue 的 directive、 transition 和 render。</li>
<li>组件设计方面，学到了使用数组管理多个同类组件；使用 <code>&lt;slot&gt;</code> 标签给开发者预留拓展空间，使用构造函数的方法来拓展组件逻辑并定义一些快捷方法。</li>
</ul>
<p>个人感觉学习一些成熟组件的源码能够学到不少东西，收获不少。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/04/01/JS 进阶必备 —— 闭包、this、箭头函数的实践笔记/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/01/JS 进阶必备 —— 闭包、this、箭头函数的实践笔记/" class="post-title-link" itemprop="url">JS 进阶必备 —— 闭包、this、箭头函数的实践笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-04-01 00:00:00" itemprop="dateCreated datePublished" datetime="2018-04-01T00:00:00+08:00">2018-04-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2019-02-16 01:20:56" itemprop="dateModified" datetime="2019-02-16T01:20:56+08:00">2019-02-16</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>闭包、this 和箭头函数是三个常见面试题，也是 js 进阶之路上的拦路虎。这次还用实践熟悉这三个问题。</p>
</blockquote>
<h1 id="this-实践"><a href="#this-实践" class="headerlink" title="this 实践"></a>this 实践</h1><h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><p>写了一段代码来验证 this 的指向。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'全局环境的this'</span>, <span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'方法中的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">child</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'方法中的方法的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    child()</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj =  &#123;</span><br><span class="line">    name: <span class="string">"object"</span>,</span><br><span class="line">    doSth: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> oName = <span class="string">"obj function name"</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'对象中的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    childObj: &#123;</span><br><span class="line">        name: <span class="string">"childObj"</span>,</span><br><span class="line">        doSth: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> arrow = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"对象中箭头函数的this"</span>, <span class="keyword">this</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            arrow()</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'对象的对象中的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    doBibao: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> count = <span class="number">500</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'闭包构造方法的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'闭包返回结果的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.doSth()</span><br><span class="line">obj.childObj.doSth()</span><br><span class="line"><span class="keyword">var</span> mbb = obj.doBibao()</span><br><span class="line">mbb()</span><br><span class="line"></span><br><span class="line">setTimeout(obj.doSth, <span class="number">1800</span>)</span><br><span class="line">setTimeout(obj.doSth.bind(obj), <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fun = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'匿名函数中的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line">fun()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"vue"</span></span><br><span class="line">        <span class="keyword">this</span>.type = <span class="string">"object"</span></span><br><span class="line">        <span class="keyword">this</span>.options = options</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'构造函数的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">        options.log()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    log: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'构造函数找那个传递方法的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bibao</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">101</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'闭包外的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        count++</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'闭包中的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bi = bibao()</span><br><span class="line"><span class="built_in">console</span>.log(bi())</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mArrow = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'箭头函数中的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line">mArrow()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'以下内容为异步执行'</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'延时箭头函数中的 this'</span>, <span class="keyword">this</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure></p>
<p>最后结果如图：<br><img src="https://upload-images.jianshu.io/upload_images/1987062-4c6444e7445a41e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="console.log"></p>
<p>从中可以得到一些结论（以下都是非严格模式下的测试结果）：</p>
<ul>
<li>全局变量的 this 指向 Window。</li>
<li>全局变量中的具名函数、匿名函数、闭包函数、箭头函数都指向 Window。</li>
<li>在对象中同步调用，this 指向当前对象。</li>
<li>在对象中异步调用，this 已重新指向 Window，如果需要指向对象需要使用 <code>bind()</code> 方法改变 this 指向。</li>
</ul>
<p>个人理解：this 作为上下文始终会有一个唯一指向对象。这个对象要么指向 Window 要么指向当前对象。<strong>当调用对象中方法时，方法中的 this 即指向方法。之后 this 会重新指向 Window。</strong></p>
<h2 id="call-amp-apply-amp-bind"><a href="#call-amp-apply-amp-bind" class="headerlink" title="call &amp; apply &amp; bind"></a>call &amp; apply &amp; bind</h2><p>说到 this 不得不说下函数的间接调用方法 apply 和 call 了。他们作用相同，唯一不同点在于 apply 方法的第二个参数接收一个参数数组。而 call 方法接收若干个参数。这两个方法的第一个参数传递的都是 this 指向。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">p1, p2</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`hello <span class="subst">$&#123;p1&#125;</span> and <span class="subst">$&#123;p2&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sayHello(<span class="string">'jack'</span>, <span class="string">'rose'</span>)</span><br><span class="line">sayHello.call(<span class="keyword">this</span>, <span class="string">'jack'</span>, <span class="string">'rose'</span>)</span><br><span class="line">sayHello.apply(<span class="keyword">this</span>, [ <span class="string">'jack'</span>, <span class="string">'rose'</span> ])</span><br></pre></td></tr></table></figure></p>
<p>如上代码，其实输出结果是一样的。第一种写法是一种语法糖，第二种和第三种才是真正的方法执行。可以看到它们的第一个参数为 this。<strong>所以，call 方法和 apply 方法是可以改变函数的 this 指向的。</strong><br>而我们之前提到的 bind 函数用于重新指定函数的 this 并且创建出一个新的函数的。引用 MDN 上的说法就是：</p>
<blockquote>
<p>bind() 方法创建一个新的函数, 当被调用时，将其this关键字设置为提供的值，在调用新函数时，在任何提供之前提供一个给定的参数序列。</p>
</blockquote>
<h1 id="箭头函数和一般函数的区别"><a href="#箭头函数和一般函数的区别" class="headerlink" title="箭头函数和一般函数的区别"></a>箭头函数和一般函数的区别</h1><p>箭头函数使用更加简洁的表达方式替代匿名函数而深受喜爱。然而箭头函数与一般匿名函数的不同点在于：<strong>箭头函数拥有静态的上下文环境，不会因为不同的调用而改变。</strong><br>以下是我理解的静态函数与一般函数的不同点：</p>
<ul>
<li><p>在箭头函数中，this 是静态的不可变的，所以bind、call和apply方法修改this不起作用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mor = &#123;</span><br><span class="line">    name: <span class="string">"mor"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ar = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"箭头函数的this变化"</span>, <span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ar() <span class="comment">// Window</span></span><br><span class="line">ar.call(mor, <span class="number">123</span>) <span class="comment">// Window 如果是匿名函数则返回 mor 对象结果</span></span><br><span class="line"><span class="keyword">var</span> newAr = ar.bind(mor)</span><br><span class="line">newAr() <span class="comment">// Window 如果是匿名函数则返回 mor 对象结果</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>箭头函数拥有静态的上下文环境，不会因为不同的调用而改变。如下例子中箭头函数的 this 指向了 Window 对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    sex: <span class="string">"male"</span>,</span><br><span class="line">    age: <span class="number">28</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person.log = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"01:"</span> + <span class="keyword">this</span>.sex + <span class="string">"-"</span> + <span class="keyword">this</span>.age) <span class="comment">// 指向 person 对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person.log02 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"02:"</span> + <span class="keyword">this</span>.sex + <span class="string">"-"</span> + <span class="keyword">this</span>.age) <span class="comment">// 指向 Window</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person.log() <span class="comment">// 01:male-28</span></span><br><span class="line">person.log02() <span class="comment">// 02:undefined-undefined</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="闭包函数的原理和用途"><a href="#闭包函数的原理和用途" class="headerlink" title="闭包函数的原理和用途"></a>闭包函数的原理和用途</h1><p>这里来简单实现一个闭包：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">100</span></span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">50</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a + b)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> count = add()</span><br><span class="line">count() <span class="comment">// 150</span></span><br></pre></td></tr></table></figure></p>
<p>我对闭包的理解就是：<strong>在函数中返回函数表达式的写法。</strong></p>
<p>闭包的主要用途有：</p>
<ul>
<li>避免被垃圾回收机制回收方法结果和变量，使变量始终保存在内存中，实现缓存的功能。如需清空缓存需要将值变为 null。</li>
<li>通过闭包获取方法中的局部变量。</li>
</ul>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>注意，以上都是本人对于这些知识点的理解，可能会有描述不太准确的地方。如有错误还请评论指出，万分感谢。<br>这里简单记录了一下我对于 this、闭包和箭头函数的理解~更多内容可以看下我提供的参考资料。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://github.com/zchen9/code/issues/1" target="_blank" rel="noopener">https://github.com/zchen9/code/issues/1</a></li>
<li><a href="https://segmentfault.com/a/1190000006875662" target="_blank" rel="noopener">https://segmentfault.com/a/1190000006875662</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/03/31/element-code-04/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/31/element-code-04/" class="post-title-link" itemprop="url">element 源码学习四 —— color-picker 源码学习</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-03-31 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-31T00:00:00+08:00">2018-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-04-03 09:50:38" itemprop="dateModified" datetime="2018-04-03T09:50:38+08:00">2018-04-03</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在 element ui 中最让我好奇的组件之一就是 color-picker 着色器组件。这里还是通过几个问题来学习一下如何实现着色器的。</p>
</blockquote>
<h1 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h1><p>在前几篇博客中说起过 element 组件都位于 <code>package</code> 目录下，那么本次学习的颜色选择器就是在 <code>package/color-picker</code> 目录中。<br>简单说下目录结构：<br><img src="https://upload-images.jianshu.io/upload_images/1987062-34971b1038d38db9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="目录结构"></p>
<ul>
<li><strong>src</strong> 源码文件夹<ul>
<li><strong>components</strong> 组件文件夹<ul>
<li><strong>alpha-slider.vue</strong> 透明度选择器</li>
<li><strong>hue-slider.vue</strong> 色调选择器</li>
<li><strong>picker-dropdown.vue</strong> 下拉界面（几个选择器的组合）</li>
<li><strong>sv-panel</strong> 颜色选择器</li>
</ul>
</li>
<li><strong>color.js</strong> 颜色处理逻辑</li>
<li><strong>draggable.js</strong> 选择器拖动效果逻辑</li>
<li><strong>main.vue</strong> color-picker 的整体界面实现。</li>
</ul>
</li>
<li><strong>cooking.conf.js</strong> <a href="http://cookingjs.github.io/zh-cn/index.html" target="_blank" rel="noopener">cooking</a> 配置</li>
<li><strong>index.js</strong> index文件，用于导出组件</li>
<li><strong>package.json</strong> 组件信息配置文件</li>
</ul>
<p>下面通过问答解决问题的方式来学习 color-picker 组件。</p>
<h1 id="回答几个源码问题"><a href="#回答几个源码问题" class="headerlink" title="回答几个源码问题"></a>回答几个源码问题</h1><h2 id="整体组件的结构是怎样的？"><a href="#整体组件的结构是怎样的？" class="headerlink" title="整体组件的结构是怎样的？"></a>整体组件的结构是怎样的？</h2><p>从整体结构来看，color-picker 的结构其实是多个组件的组合而成的。</p>
<ul>
<li><strong>显示颜色结果的 span</strong> 和<strong>选择颜色的下拉框</strong>组成整体的 color-picker 组件；</li>
<li>其中<strong>下拉框</strong>由以下组件组合而成；<ul>
<li>3个颜色选择器</li>
<li>1个input</li>
<li>1个清空button</li>
<li>1个确定button</li>
</ul>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/1987062-f84f7d12052e86d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="组件结构"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/1987062-c9e4c7f3c5b7a2aa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="结构图"></p>
<h2 id="选择器的背景颜色变化是如何实现的？"><a href="#选择器的背景颜色变化是如何实现的？" class="headerlink" title="选择器的背景颜色变化是如何实现的？"></a>选择器的背景颜色变化是如何实现的？</h2><p>3 个颜色选择器都是由 CSS3 的线性渐变效果 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient" target="_blank" rel="noopener">linear-gradient()</a> 来实现的。下面是简化版~<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.div01</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 27px;</span></span><br><span class="line"><span class="undefined">        height: 350px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-tag">linear-gradient</span>(<span class="selector-tag">to</span> <span class="selector-tag">bottom</span>, <span class="selector-tag">red</span> 0, <span class="selector-id">#ff0</span> 17%, <span class="selector-id">#0f0</span> 33%, <span class="selector-id">#0ff</span> 50%, <span class="selector-id">#00f</span> 67%, <span class="selector-id">#f0f</span> 83%, <span class="selector-tag">red</span> 100%);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.bg-white</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 450px;</span></span><br><span class="line"><span class="undefined">        height: 350px;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-tag">linear-gradient</span>(<span class="selector-tag">to</span> <span class="selector-tag">right</span>, <span class="selector-id">#fff</span>, <span class="selector-tag">rgba</span>(255, 255, 255, 0));</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.bg-black</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 450px;</span></span><br><span class="line"><span class="undefined">        height: 350px;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-tag">linear-gradient</span>(<span class="selector-tag">to</span> <span class="selector-tag">top</span>, <span class="selector-id">#000</span>, <span class="selector-tag">transparent</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.div02</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 450px;</span></span><br><span class="line"><span class="undefined">        height: 350px;</span></span><br><span class="line"><span class="undefined">        position: relative;</span></span><br><span class="line"><span class="undefined">        background: rgb(213, 0, 255);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.div03</span> &#123;</span></span><br><span class="line"><span class="undefined">        height: 27px;</span></span><br><span class="line"><span class="undefined">        width: 450px;</span></span><br><span class="line"><span class="undefined">        background: linear-gradient(to right, rgba(213, 0, 255, 0) 0%, rgb(213, 0, 255) 100%);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div02"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bg-white"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bg-black"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div01"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div03"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>最终结果如图所示：<img src="https://upload-images.jianshu.io/upload_images/1987062-0318237c94811e07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="显示结果"></p>
<p>原来看似复杂的颜色选择器知识用了几个渐变就组合出来了，CSS 真的很强大！</p>
<h2 id="如何计算并获取选中的色值？"><a href="#如何计算并获取选中的色值？" class="headerlink" title="如何计算并获取选中的色值？"></a>如何计算并获取选中的色值？</h2><p>颜色结果的计算逻辑都在 color.js 中了，来简单看下代码。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hsv 转 hsl</span></span><br><span class="line"><span class="keyword">const</span> hsv2hsl = <span class="function"><span class="keyword">function</span>(<span class="params">hue, sat, val</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否为 1.0</span></span><br><span class="line"><span class="keyword">const</span> isOnePointZero = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否为百分比</span></span><br><span class="line"><span class="keyword">const</span> isPercentage = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Take input from [0, n] and return it as [0, 1]</span></span><br><span class="line"><span class="keyword">const</span> bound01 = <span class="function"><span class="keyword">function</span>(<span class="params">value, max</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 十进制转十六进制</span></span><br><span class="line"><span class="keyword">const</span> INT_HEX_MAP = &#123; <span class="number">10</span>: <span class="string">'A'</span>, <span class="number">11</span>: <span class="string">'B'</span>, <span class="number">12</span>: <span class="string">'C'</span>, <span class="number">13</span>: <span class="string">'D'</span>, <span class="number">14</span>: <span class="string">'E'</span>, <span class="number">15</span>: <span class="string">'F'</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转为十六进制颜色值</span></span><br><span class="line"><span class="keyword">const</span> toHex = <span class="function"><span class="keyword">function</span>(<span class="params">&#123; r, g, b &#125;</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 十六进制转十进制</span></span><br><span class="line"><span class="keyword">const</span> HEX_INT_MAP = &#123; <span class="attr">A</span>: <span class="number">10</span>, <span class="attr">B</span>: <span class="number">11</span>, <span class="attr">C</span>: <span class="number">12</span>, <span class="attr">D</span>: <span class="number">13</span>, <span class="attr">E</span>: <span class="number">14</span>, <span class="attr">F</span>: <span class="number">15</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析十六进制</span></span><br><span class="line"><span class="keyword">const</span> parseHexChannel = <span class="function"><span class="keyword">function</span>(<span class="params">hex</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hsl 转 hsv</span></span><br><span class="line"><span class="keyword">const</span> hsl2hsv = <span class="function"><span class="keyword">function</span>(<span class="params">hue, sat, light</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// rgb 转 hsv</span></span><br><span class="line"><span class="keyword">const</span> rgb2hsv = <span class="function"><span class="keyword">function</span>(<span class="params">r, g, b</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// hsv 转 rgb</span></span><br><span class="line"><span class="keyword">const</span> hsv2rgb = <span class="function"><span class="keyword">function</span>(<span class="params">h, s, v</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>._hue = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>._saturation = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">this</span>._value = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">this</span>._alpha = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.enableAlpha = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.format = <span class="string">'hex'</span>;</span><br><span class="line">    <span class="keyword">this</span>.value = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    options = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> option <span class="keyword">in</span> options) &#123;</span><br><span class="line">      <span class="keyword">if</span> (options.hasOwnProperty(option)) &#123;</span><br><span class="line">        <span class="keyword">this</span>[option] = options[option];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.doOnChange();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 设置属性值</span></span><br><span class="line">  set(prop, value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">1</span> &amp;&amp; <span class="keyword">typeof</span> prop === <span class="string">'object'</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> p <span class="keyword">in</span> prop) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop.hasOwnProperty(p)) &#123;</span><br><span class="line">          <span class="keyword">this</span>.set(p, prop[p]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>[<span class="string">'_'</span> + prop] = value;</span><br><span class="line">    <span class="keyword">this</span>.doOnChange();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取属性值 _hue</span></span><br><span class="line">  get(prop) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[<span class="string">'_'</span> + prop];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 颜色值转为 rgb 返回</span></span><br><span class="line">  toRgb() &#123;</span><br><span class="line">    <span class="keyword">return</span> hsv2rgb(<span class="keyword">this</span>._hue, <span class="keyword">this</span>._saturation, <span class="keyword">this</span>._value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 格式化传入的值</span></span><br><span class="line">  fromString(value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!value) &#123;</span><br><span class="line">      <span class="keyword">this</span>._hue = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">this</span>._saturation = <span class="number">100</span>;</span><br><span class="line">      <span class="keyword">this</span>._value = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.doOnChange();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定义计算出结果后：赋值、改变。</span></span><br><span class="line">    <span class="keyword">const</span> fromHSV = <span class="function">(<span class="params">h, s, v</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>._hue = <span class="built_in">Math</span>.max(<span class="number">0</span>, <span class="built_in">Math</span>.min(<span class="number">360</span>, h));</span><br><span class="line">      <span class="keyword">this</span>._saturation = <span class="built_in">Math</span>.max(<span class="number">0</span>, <span class="built_in">Math</span>.min(<span class="number">100</span>, s));</span><br><span class="line">      <span class="keyword">this</span>._value = <span class="built_in">Math</span>.max(<span class="number">0</span>, <span class="built_in">Math</span>.min(<span class="number">100</span>, v));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.doOnChange();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 颜色变化逻辑，最后都会转为 HSV 三个值执行 fromHSV 方法 */</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更具计算结果定义当前颜色值 value</span></span><br><span class="line">  doOnChange() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; _hue, _saturation, _value, _alpha, format &#125; = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.enableAlpha) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (format) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'hsl'</span>:</span><br><span class="line">          <span class="keyword">const</span> hsl = hsv2hsl(_hue, _saturation / <span class="number">100</span>, _value / <span class="number">100</span>);</span><br><span class="line">          <span class="keyword">this</span>.value = <span class="string">`hsla(<span class="subst">$&#123; _hue &#125;</span>, <span class="subst">$&#123; <span class="built_in">Math</span>.round(hsl[<span class="number">1</span>] * <span class="number">100</span>) &#125;</span>%, <span class="subst">$&#123; <span class="built_in">Math</span>.round(hsl[<span class="number">2</span>] * <span class="number">100</span>) &#125;</span>%, <span class="subst">$&#123; _alpha <span class="regexp">/ 100&#125;)`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          break;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">        case 'hsv':</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          this.value = `hsva($&#123; _hue &#125;, $&#123; Math.round(_saturation) &#125;%, $&#123; Math.round(_value) &#125;%, $&#123; _alpha /</span> <span class="number">100</span>&#125;</span>)`</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">const</span> &#123; r, g, b &#125; = hsv2rgb(_hue, _saturation, _value);</span><br><span class="line">          <span class="keyword">this</span>.value = <span class="string">`rgba(<span class="subst">$&#123;r&#125;</span>, <span class="subst">$&#123;g&#125;</span>, <span class="subst">$&#123;b&#125;</span>, <span class="subst">$&#123; _alpha <span class="regexp">/ 100 &#125;)`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">      &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    &#125; else &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">      switch (format) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">        case 'hsl':</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          const hsl = hsv2hsl(_hue, _saturation /</span> <span class="number">100</span>, _value <span class="regexp">/ 100);</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          this.value = `hsl($&#123; _hue &#125;, $&#123; Math.round(hsl[1] * 100) &#125;%, $&#123; Math.round(hsl[2] * 100) &#125;%)`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          break;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">        case 'hsv':</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          this.value = `hsv($&#123; _hue &#125;, $&#123; Math.round(_saturation) &#125;%, $&#123; Math.round(_value) &#125;%)`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          break;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">        case 'rgb':</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          const &#123; r, g, b &#125; = hsv2rgb(_hue, _saturation, _value);</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          this.value = `rgb($&#123;r&#125;, $&#123;g&#125;, $&#123;b&#125;)`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          break;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">        default:</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          this.value = toHex(hsv2rgb(_hue, _saturation, _value));</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">      &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">&#125;;</span></span></span></span><br></pre></td></tr></table></figure></p>
<p>其中，将工具方法和计算颜色的具体方法隐藏了，只看具体逻辑。<br>其实 color.js 主要是定义了一个 Color 类，简单说下其中一些方法的作用：</p>
<ul>
<li>set 用于设置 Color 中的变量。</li>
<li>get 用于获取 <code>_hue</code> <code>_saturation</code> <code>_value</code> <code>_alpha</code> 这四个值。</li>
<li>toRgb 方法将当前颜色的值（除了透明度）以 RGB 的形式返回。</li>
<li>fromString 方法将传入的颜色值解析成 HSV 格式，并赋值给 <code>_hue</code> <code>_saturation</code> <code>_value</code> 和 <code>_alpha</code>。</li>
<li>doOnChange 方法将会计算颜色值组成字符串传给 <code>value</code>。</li>
</ul>
<p>至此，Color 的大致功能就清晰了：<strong>解析传入的颜色值为 HSVA 格式分别表示为 <code>_hue</code> <code>_saturation</code> <code>_value</code> 和 <code>_alpha</code>，并且组合成颜色字符串传给 <code>value</code>。</strong><br>现在需要把获取到的颜色值传给显示结果的 span，那么就从 <code>main.vue</code> 的中显示颜色结果的 <code>&lt;span&gt;</code> 标签开始看起。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"el-color-picker__color-inner"</span> <span class="attr">:style</span>=<span class="string">"&#123; backgroundColor: displayedColor &#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>背景色调用了 displayedColor 这个 computed 属性：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  computed: &#123;</span><br><span class="line">    displayedColor() &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.value &amp;&amp; !<span class="keyword">this</span>.showPanelColor) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'transparent'</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; r, g, b &#125; = <span class="keyword">this</span>.color.toRgb();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.showAlpha</span><br><span class="line">          ? <span class="string">`rgba(<span class="subst">$&#123; r &#125;</span>, <span class="subst">$&#123; g &#125;</span>, <span class="subst">$&#123; b &#125;</span>, <span class="subst">$&#123; <span class="keyword">this</span>.color.get(<span class="string">'alpha'</span>) <span class="regexp">/ 100 &#125;)`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">          : `rgb($&#123; r &#125;, $&#123; g &#125;, $&#123; b &#125;)`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">      &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    &#125;,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">&#125;</span></span></span></span><br></pre></td></tr></table></figure></p>
<p>这里的 <code>this.value</code> 是 props 中传入的属性。如果没有传入 <code>value</code> 并且没有选择过颜色，那么显示透明色；<br>而 <code>this.color</code> 是 Color 类的实例化对象：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> color = <span class="keyword">new</span> Color(&#123;</span><br><span class="line">   enableAlpha: <span class="keyword">this</span>.showAlpha,</span><br><span class="line">   format: <span class="keyword">this</span>.colorFormat</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>
<p>所以，就调用了我们上面所说的 <code>toRgb</code> 方法，最后返回颜色结果。<br>至此，实现了颜色的计算、获取和显示。</p>
<h2 id="颜色选择器如何获取和修改颜色值？"><a href="#颜色选择器如何获取和修改颜色值？" class="headerlink" title="颜色选择器如何获取和修改颜色值？"></a>颜色选择器如何获取和修改颜色值？</h2><p>在下拉菜单中 <code>hue-slider</code> 组件获取色调（哪种颜色）、<code>sv-panel</code> 获取具体的颜色值、<code>alpha-silder</code> 获取透明度。<br>这三个组件通过 props 获取父级组件传递的的 <code>color</code> 对象来显示颜色。如果颜色选择器的选择块移动后，通过修改 <code>color</code> 值来实现颜色的修改。</p>
<h2 id="颜色选择器的选择块如何实现"><a href="#颜色选择器的选择块如何实现" class="headerlink" title="颜色选择器的选择块如何实现"></a>颜色选择器的选择块如何实现</h2><p>选择颜色的过程其实就是选择器位移发生变化的过程。下面是作者参照 element 做的一个在有限范围内任意移动选择器的 demo：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-id">#container</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 500px;</span></span><br><span class="line"><span class="undefined">        height: 500px;</span></span><br><span class="line"><span class="undefined">        position: relative;</span></span><br><span class="line"><span class="undefined">        border: 1px solid black;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.drag</span> &#123;</span></span><br><span class="line"><span class="undefined">        height: 4px;</span></span><br><span class="line"><span class="undefined">        width: 4px;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">        border-radius: 50%;</span></span><br><span class="line"><span class="undefined">        border: 1px solid red;</span></span><br><span class="line"><span class="undefined">        cursor: pointer;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">ref</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"drag"</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">:style</span>=<span class="string">"&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">            top: cursorTop + 'px',</span></span></span><br><span class="line"><span class="tag"><span class="string">            left: cursorLeft + 'px'</span></span></span><br><span class="line"><span class="tag"><span class="string">        &#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">"#app"</span>,</span></span><br><span class="line"><span class="undefined">        data: &#123;</span></span><br><span class="line"><span class="undefined">            cursorLeft: 0,</span></span><br><span class="line"><span class="undefined">            cursorTop: 0,</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        mounted() &#123;</span></span><br><span class="line"><span class="javascript">            draggable(<span class="keyword">this</span>.$el, &#123;</span></span><br><span class="line"><span class="javascript">                drag: <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.handleDrag(event);</span></span><br><span class="line"><span class="undefined">                &#125;,</span></span><br><span class="line"><span class="javascript">                end: <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.handleDrag(event);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.update();</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="undefined">            handleDrag(event) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> container = <span class="keyword">this</span>.$refs.container</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> el = <span class="keyword">this</span>.$el;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> rect = container.getBoundingClientRect();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> left = event.clientX - rect.left;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> top = event.clientY - rect.top;</span></span><br><span class="line"><span class="javascript">                left = <span class="built_in">Math</span>.max(<span class="number">0</span>, left);</span></span><br><span class="line"><span class="javascript">                left = <span class="built_in">Math</span>.min(left, rect.width - <span class="number">6</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                top = <span class="built_in">Math</span>.max(<span class="number">0</span>, top);</span></span><br><span class="line"><span class="javascript">                top = <span class="built_in">Math</span>.min(top, rect.height - <span class="number">6</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.cursorLeft = left;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.cursorTop = top;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> isDragging = <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">draggable</span>(<span class="params">element, options</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (Vue.prototype.$isServer) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> moveFn = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (options.drag) &#123;</span></span><br><span class="line"><span class="undefined">                options.drag(event);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> upFn = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.removeEventListener(<span class="string">'mousemove'</span>, moveFn);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.removeEventListener(<span class="string">'mouseup'</span>, upFn);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.onselectstart = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.ondragstart = <span class="literal">null</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            isDragging = <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (options.end) &#123;</span></span><br><span class="line"><span class="undefined">                options.end(event);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        element.addEventListener(<span class="string">'mousedown'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (isDragging) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.onselectstart = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.ondragstart = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.addEventListener(<span class="string">'mousemove'</span>, moveFn);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.addEventListener(<span class="string">'mouseup'</span>, upFn);</span></span><br><span class="line"><span class="javascript">            isDragging = <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (options.start) &#123;</span></span><br><span class="line"><span class="undefined">                options.start(event);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>好吧，我知道代码太长了，要看效果请移步<a href="https://jsfiddle.net/VioletJack/ezttuvmf/1/" target="_blank" rel="noopener">此处</a>。<br>选择器的逻辑如下：</p>
<ul>
<li>根据 props 传入的颜色值初次计算选择器的位置。</li>
<li>拖动选择器，根据选择器位置、已知的 color 属性计算当前选择器位置的颜色结果。</li>
</ul>
<p>也就是说做一个选择器需要的就是<strong>一个可拖动的选择器</strong>和<strong>一套计算颜色的算法逻辑</strong>。比如在 <code>sv-silder</code> 中的算法逻辑如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算 cursor 位置</span></span><br><span class="line"><span class="keyword">this</span>.cursorLeft = saturation * width / <span class="number">100</span>;</span><br><span class="line"><span class="keyword">this</span>.cursorTop = (<span class="number">100</span> - value) * height / <span class="number">100</span>;</span><br><span class="line"><span class="comment">// 计算颜色</span></span><br><span class="line"><span class="keyword">this</span>.color.set(&#123;</span><br><span class="line">  saturation: left / rect.width * <span class="number">100</span>,</span><br><span class="line"> value: <span class="number">100</span> - top / rect.height * <span class="number">100</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>其他两个选择器原理也是类似的~</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>至此，我对 color-picker 的一些疑惑都解开了，也写了一些 demo 来玩玩。对该组件有了大致的理解了~不得不感叹作者对于 CSS 和 Vue 的掌握真的非常熟练。学到了不少东西，感谢开源社区给我们提供了那么多好东西给我们使用和学习~<br>再下一篇文章中我想探索下其他一些有趣的 element 组件，敬请期待！</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/03/28/CSS 基础知识整理/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/28/CSS 基础知识整理/" class="post-title-link" itemprop="url">CSS 基础知识整理</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-03-28 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-28T00:00:00+08:00">2018-03-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2019-02-16 01:20:56" itemprop="dateModified" datetime="2019-02-16T01:20:56+08:00">2019-02-16</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>对于 CSS，由于过度依赖美工导致 CSS 很弱，所以这次好好学习 CSS相关东西。</p>
</blockquote>
<h1 id="盒子模型"><a href="#盒子模型" class="headerlink" title="盒子模型"></a>盒子模型</h1><p>盒子模型是由 margin、border、padding 和 content 属性组成的。</p>
<ul>
<li>margin 就是 border 外的透明边距区域。如 <code>margin: 10px;</code>。</li>
<li>border 就是边框属性，可以定义边框的宽度、样式和颜色。如 <code>border: 5px solid red</code>。</li>
<li>padding 就是 border 内的透明填充边距。如 <code>padding: 10px;</code>。</li>
<li>content 也就是容器内要显示内容的区域。</li>
</ul>
<p>盒子模型唯一要注意的就是边框的界定问题。IE 的 width 和 height 包括了 border 和 padding 的宽度，而 w3c （其他浏览器）的 wdith 和 height 只作用域 content，与 padding、padding 都区分出来的。<br>即在 IE 中，<code>content.width + padding.width * 2 + border.width * 2 = width</code>。<br>w3c 中 <code>content.width = width</code>。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid red;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/1987062-41823df9d5d2ab83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="chrome中的盒子模型"></p>
<h1 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h1><ul>
<li>visible 超出边框显示</li>
<li>hidden 隐藏超出文本</li>
<li>scroll 换行滚动</li>
<li>auto 自动换行</li>
<li>inherit 继承父级CSS的属性</li>
</ul>
<p>关于 scroll 和 auto 的区别，这篇<a href="https://www.jianshu.com/p/1ac2933891cd" target="_blank" rel="noopener">文章</a>中讲的很详细。</p>
<h1 id="display"><a href="#display" class="headerlink" title="display"></a>display</h1><ul>
<li>none 隐藏，不占空间</li>
<li>block 元素间换行，带有换行符</li>
<li>inline 默认，元素间不换行。宽度满了之后换行显示，流式布局显示。</li>
<li>inline-block 和 inline 效果相同，流式布局显示。于 inline 不同之处在于 inline 不可设置宽高，inline-block 可以设置宽高。</li>
<li>list-item 作为列表元素，换行显示。</li>
<li>table 块级元素表格，后面带有回车。与 block 和 list-item 不同之处于宽度不是撑满整个页面。</li>
<li>flex 将当前容器元素变为 flex 弹性盒模型。</li>
</ul>
<p>其他 display 还有许多 table-<em>*</em> 属性，感觉不常用暂且忽略了。</p>
<h1 id="position"><a href="#position" class="headerlink" title="position"></a>position</h1><ul>
<li>absolute 对非 static 父元素的绝对定位，脱离流。</li>
<li>fixed 对于浏览器窗口的绝对定位，悬浮，脱离流。</li>
<li>relative 相对父元素定位，在流中。</li>
<li>static 默认值，没有定位，在流中。</li>
</ul>
<h1 id="left、right、top、bottom"><a href="#left、right、top、bottom" class="headerlink" title="left、right、top、bottom"></a>left、right、top、bottom</h1><p>这四个属性定义了<strong>定位元素相应外边距边界</strong>与<strong>其包含块相应边界</strong>之间的偏移。如 <code>left: 20;px</code> 就是子元素相对于父元素向右偏移移 20px。<br>如果元素定义为 absolute，不设置 width 和 height，而设置上下左右四个属性那么就会根据父级元素容器来定义元素的宽高。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">25px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果同时设置了 <code>width</code> <code>height</code> <code>top</code> <code>left</code> <code>right</code> <code>bottom</code>，那么就取 <code>width</code> <code>height</code> <code>top</code> <code>left</code> 属性。<br>优先级而言：宽高优先级最高，<code>top</code> <code>left</code> 其次，<code>right</code> <code>bottom</code> 最后。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>暂时就写这么多吧，把常见的没搞懂的 CSS  给过了一遍，要想更好的掌握 CSS，必须多多动手实践才可以。<br>如有其他常用的 CSS 属性将会继续更新~</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/03/25/被人忽视的 DOM API/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/25/被人忽视的 DOM API/" class="post-title-link" itemprop="url">被人忽视的 DOM API</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-03-25 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-25T00:00:00+08:00">2018-03-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2019-02-16 01:20:56" itemprop="dateModified" datetime="2019-02-16T01:20:56+08:00">2019-02-16</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在框架盛行的年代，还有多少人记得在没有框架时我们如何控制 dom 的行为呢？作者本人也一直忽视了这方面的学习，直到面试问到这个问题，下决心好好认识认识这个 dom api。</p>
</blockquote>
<h1 id="node、document-和-element"><a href="#node、document-和-element" class="headerlink" title="node、document 和 element"></a>node、document 和 element</h1><p>在学习 dom api 时对这三者还是挺混乱的。理一下他们之间的关系。</p>
<h2 id="node"><a href="#node" class="headerlink" title="node"></a>node</h2><p>node 是一个接口，像 document 和 element 都是继承这个接口的。这个接口提供了 dom 节点的获取和操作方法。<br>node 有许多类型，下图列出了一些 node 的类型码。由图可见 element 的类型码为 1，文本节点类型码为 3，注释节点类型码为 8，document 的类型码为 9。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1987062-2ff52ed17c0e5c1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="node type"></p>
<p>这让我想到了 vue.js 中出现多次的代码：<code>if (child.nodeType === 3) { ... }</code> 其实就是判断当前节点是否为文本节点。</p>
<h2 id="element"><a href="#element" class="headerlink" title="element"></a>element</h2><p>从上面的内容可知，element 就是一个特殊的 node（nodeType == 1），其实 element 就是 HTML 各类标签，如 </p><p><div> 这类有特殊含义的，能够携带一些特殊属性的节点。所以说 element 可以用 node 的所有 api。</div></p>
<h2 id="document"><a href="#document" class="headerlink" title="document"></a>document</h2><p>同理，document 也是一个特殊的 node，它与 element 的不同之处在于 document 通常是 DOM 节点，即包含有 head 和 body 元素的一个 node。</p>
<p>参考：<a href="https://stackoverflow.com/questions/9979172/difference-between-node-object-and-element-object" target="_blank" rel="noopener">Difference between Node object and Element object? - Stack Overflow</a></p>
<h1 id="api-学习"><a href="#api-学习" class="headerlink" title="api 学习"></a>api 学习</h1><p>首先我发现一点：<strong>所有 dom 操作的起点都是使用 document 去获取各种类型的 node （集合）然后再去执行各类 dom 操作的行为！</strong><br>由于 document 操作的 api 真的很多，所以我选取我想了解的部分学习了。在这里我学习 DOM API 的目的是：</p>
<blockquote>
<p>学习 <code>document</code> 对象操作 dom 的方式，拥有脱离框架（jquery、vue等）来操作 dom 的能力。</p>
</blockquote>
<h2 id="获取节点"><a href="#获取节点" class="headerlink" title="获取节点"></a>获取节点</h2><ul>
<li><strong>Document.documentElement</strong> 返回 document 的直属后代元素。</li>
<li><strong>Document.activeElement</strong> 返回当前正在操作的元素</li>
<li><strong>Document.body</strong> 返回当前文档的 <code>&lt;body&gt;</code> 元素。与此类似的还有 Document.head 和 Document.scripts 两个属性返回当前文档的 <code>&lt;head&gt;</code> 和 <code>&lt;script&gt;</code> 元素。</li>
<li><strong>Document.getElementByClassName()</strong> 返回有给定样式名的元素列表</li>
<li><strong>Document.getElementByTagName()</strong> 返回有给定标签名的元素列表</li>
<li><strong>document.getElementById()</strong> 返回一个对识别元素的对象引用</li>
<li><strong>document.querySelector()</strong> 返回文档中第一个匹配指定选择器的元素</li>
<li><strong>document.querySelectorAll()</strong> 返回一个匹配指定选择器的元素节点列表</li>
<li><strong>Node.childNodes</strong> 返回一个包含了该节点所有子节点的实时的 <code>NodeList</code> 是“实时的”意思是，如果该节点的子节点发生了变化，<code>NodeList</code> 对象就会自动更新。</li>
<li><strong>Node.firstChild &amp; Node.lastChild</strong> 返回该节点的第一个子节点或最后一个子节点，如果该节点没有子节点则返回 null。</li>
<li><strong>Node.previousSibling &amp; Node.nextSibling</strong> 返回与该节点同级的上一个或下一个节点，如果没有返回null。</li>
<li><strong>Node.ownerDocument</strong> 返回这个元素属于的 <code>Document</code> 对象 。</li>
<li><strong>Node.parentNode</strong> 返回一个当前结点 <code>Node</code> 的父节点 。</li>
<li><strong>Node.parentElement</strong> 返回一个当前节点的父节点 <code>Element</code>。</li>
</ul>
<h2 id="操作节点"><a href="#操作节点" class="headerlink" title="操作节点"></a>操作节点</h2><ul>
<li><strong>Document.createComment()</strong> 创建一个新的注释节点并返回它</li>
<li><strong>Document.createDocumentFragment()</strong> 创建一个新的文档片段</li>
<li><strong>Document.createElement()</strong> 用给定的标签名创建一个新的元素。</li>
<li><strong>Document.createTextNode()</strong> 创建一个文字节点</li>
<li><strong>Document.write()</strong> 向文档中写入内容（与之有类似功能的是 Document.writeln() 不同之处在于后面多了个换行符。）</li>
<li><strong>Element.innerHTML</strong> 设置或返回元素的内容</li>
<li><strong>Node.textContent</strong> 获取或设置一个标签内所有子结点及其后代的文本内容。</li>
<li><strong>Node.appendChild()</strong> 向元素添加新的子节点，作为最后一个子节点。</li>
<li><strong>Node.cloneNode()</strong> 克隆元素（方法中传参为deep，如果deep为true则深拷贝。）</li>
<li><strong>Node.insertBefore()</strong> 在指定已有节点前插入新节点（没有 <code>insertAfter</code> 方法。可以使用 <code>insertBefore</code> 方法和 <code>nextSibling</code> 来模拟它。）</li>
<li><strong>Node.normalize()</strong> 合并元素中相邻文本节点</li>
<li><strong>Node.removeChild()</strong> 从元素中移除子节点</li>
<li><strong>Node.replaceChild()</strong> 替换元素中的子节点</li>
</ul>
<p>其中 Document 的 <code>createXXX</code> 方法还有一些其他不常用的，如需使用请查阅 MDN。</p>
<h2 id="其他常用属性和方法"><a href="#其他常用属性和方法" class="headerlink" title="其他常用属性和方法"></a>其他常用属性和方法</h2><ul>
<li><strong>Element.classList</strong> 返回元素的 class 集合。</li>
<li><strong>EventTaget.addEventListener()</strong> 注册监听事件</li>
<li><strong>Node.nodeType</strong> 返回该节点的类型码</li>
<li><strong>Node.nodeValue</strong> 返回或设置当前节点的值。</li>
<li><strong>Node.compareDocumentPosition()</strong> 比较当前节点与任意文档中的另一个节点的位置关系。</li>
<li><strong>Node.contains()</strong> 传入的节点是否为该节点的后代节点。</li>
<li><strong>Node.hasChildNodes()</strong> 是否拥有子节点</li>
<li><strong>Node.isEqualNode()</strong> 检查两个元素是否相等</li>
<li><strong>Node.isSameNode()</strong> 检查两个元素是否为相同的节点</li>
</ul>
<p>以上内容均参考了 MDN 上的内容：</p>
<ul>
<li>Node <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Node</a></li>
<li>Element <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Element</a></li>
<li>Document <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Document</a></li>
</ul>
<h1 id="写个操作-DOM-的例子"><a href="#写个操作-DOM-的例子" class="headerlink" title="写个操作 DOM 的例子"></a>写个操作 DOM 的例子</h1><p>接下来就使用这些 API 来进行一些 DOM操作。</p>
<h2 id="获取各个位置的节点。"><a href="#获取各个位置的节点。" class="headerlink" title="获取各个位置的节点。"></a>获取各个位置的节点。</h2><p>这里写了个小demo：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>get dom<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>hello world 1<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>hello world 2<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>hello world 3<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>hello world 4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>hello world 5<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>commit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'列出所有node'</span>, container.childNodes)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> h1 = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'h1'</span>)[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'获取h1后的元素'</span>, h1.nextSibling)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> uldiv = container.firstChild</span></span><br><span class="line"><span class="javascript">    <span class="keyword">while</span> (uldiv &amp;&amp; uldiv.nodeType != <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="undefined">        uldiv = uldiv.nextSibling</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> ul = uldiv.lastChild</span></span><br><span class="line"><span class="javascript">    <span class="keyword">while</span> (ul &amp;&amp; ul.nodeType == <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="undefined">        ul = ul.previousSibling</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'获取ul中第一个元素内容'</span>, ul.firstChild)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> doc = h1.ownerDocument</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'获取当前 Document 对象'</span>, doc)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> li1 = ul.firstChild</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'获取li的父级节点'</span>, li1.parentElement)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> button = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"button"</span>)[<span class="number">0</span>]</span></span><br><span class="line"><span class="undefined">    button.onclick = log</span></span><br><span class="line"><span class="undefined">    button.focus()</span></span><br><span class="line"><span class="undefined">    button.click()</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'获取正在操作的元素'</span>, <span class="built_in">document</span>.activeElement)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'button is clicked'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>最后返回结果如图：<br><img src="https://upload-images.jianshu.io/upload_images/1987062-9f315855a37c0b17.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="返回结果"><br>由于在 chrome 中空格、换行算是文本节点。所以获取最后元素的时候总是会获取到那些文本节点上去。这个要注意的。所以我在代码中使用 <code>nodeType == 1</code> 来区分是否为元素。<br>在上面例子中查找了各种关系的元素，解决日常元素获取问题应该不难了。</p>
<h2 id="实践创建node、插入node和删除node。"><a href="#实践创建node、插入node和删除node。" class="headerlink" title="实践创建node、插入node和删除node。"></a>实践创建node、插入node和删除node。</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">"child"</span>&gt;</span>Hello Child<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"buttonGroup"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 父节点向子节点插入元素</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">appendChild</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">"container"</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> text = <span class="built_in">document</span>.createElement(<span class="string">"h2"</span>)</span></span><br><span class="line"><span class="javascript">        text.textContent = <span class="string">'Hello New Child'</span></span></span><br><span class="line"><span class="undefined">        container.appendChild(text)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 子节点获取父节点，在父节点后插入元素</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">appendParent</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> child = <span class="built_in">document</span>.getElementById(<span class="string">'child'</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> parent = child.parentElement</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> text = <span class="built_in">document</span>.createElement(<span class="string">"h1"</span>)</span></span><br><span class="line"><span class="javascript">        text.textContent = <span class="string">'Hello Parent'</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> root = parent.parentElement</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        root.insertBefore(text, parent.nextSibling)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 在当前元素前插入元素</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">appendPre</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> child = <span class="built_in">document</span>.getElementById(<span class="string">'child'</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> text = <span class="built_in">document</span>.createElement(<span class="string">"h2"</span>)</span></span><br><span class="line"><span class="javascript">        text.textContent = <span class="string">'Hello Pre Child'</span></span></span><br><span class="line"><span class="undefined">        child.parentElement.insertBefore(text, child)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 在当前元素后插入元素</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">appendNext</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> child = <span class="built_in">document</span>.getElementById(<span class="string">'child'</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> text = <span class="built_in">document</span>.createElement(<span class="string">"h2"</span>)</span></span><br><span class="line"><span class="javascript">        text.textContent = <span class="string">'Hello Next Child'</span></span></span><br><span class="line"><span class="undefined">        child.parentElement.insertBefore(text, child.nextSibling)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 移除父元素中最后一个子元素</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">removeEle</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (container.lastChild) &#123;</span></span><br><span class="line"><span class="undefined">            container.removeChild(container.lastChild)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 替换父元素中的子元素</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">replaceEle</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> child = <span class="built_in">document</span>.getElementById(<span class="string">"child"</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> newNode = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span></span><br><span class="line"><span class="xml">        newNode.innerHTML = "<span class="tag">&lt;<span class="name">button</span>&gt;</span>button<span class="tag">&lt;/<span class="name">button</span>&gt;</span>hello new node replaced"</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> parent = child.parentElement</span></span><br><span class="line"><span class="undefined">        parent.replaceChild(newNode, child)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 创建按钮组</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> ButtonGroup = <span class="built_in">document</span>.getElementById(<span class="string">"buttonGroup"</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> EventList = [ </span></span><br><span class="line"><span class="javascript">        <span class="string">"appendChild"</span>, </span></span><br><span class="line"><span class="javascript">        <span class="string">"appendParent"</span>, </span></span><br><span class="line"><span class="javascript">        <span class="string">"appendPre"</span>, </span></span><br><span class="line"><span class="javascript">        <span class="string">"appendNext"</span>, </span></span><br><span class="line"><span class="javascript">        <span class="string">"removeEle"</span>, </span></span><br><span class="line"><span class="javascript">        <span class="string">"replaceEle"</span> </span></span><br><span class="line"><span class="undefined">    ]</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> ButtonArr = []</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">of</span> EventList) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> btn = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>)</span></span><br><span class="line"><span class="undefined">        btn.textContent = key</span></span><br><span class="line"><span class="javascript">        btn.onclick = <span class="built_in">eval</span>(key)</span></span><br><span class="line"><span class="undefined">        ButtonArr.push(btn)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">var</span> b <span class="keyword">of</span> ButtonArr) &#123;</span></span><br><span class="line"><span class="undefined">        ButtonGroup.appendChild(b)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上代码实现了<strong>在各个位置插入元素</strong>和<strong>元素的删除替换</strong>，点击<a href="https://jsfiddle.net/VioletJack/g4nt26yf/1/" target="_blank" rel="noopener">此处</a>查看运行结果。</p>
<h2 id="简单实现-v-for、v-text、v-html、v-on-和-v-model-这些功能。"><a href="#简单实现-v-for、v-text、v-html、v-on-和-v-model-这些功能。" class="headerlink" title="简单实现 v-for、v-text、v-html、v-on 和 v-model 这些功能。"></a>简单实现 v-for、v-text、v-html、v-on 和 v-model 这些功能。</h2><p>好吧，作为一个 Vue.js 爱好者，绕不开的想到了 Vue.js 操作 DOM 的一些功能。这里就试着简单实现下（不涉及 Virtual DOM，只是单纯的 DOM 修改）。<br>如果对 Vue 命令不了解可以去官网看看这些<a href="https://cn.vuejs.org/v2/api/#%E6%8C%87%E4%BB%A4" target="_blank" rel="noopener">指令</a>的用法。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello Ele<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-text<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-html<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">"messagespan"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>          </span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-model<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"message"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-on<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"myInput"</span> <span class="attr">v-on:blur</span>=<span class="string">"blur"</span> <span class="attr">v-on:focus</span>=<span class="string">"focus"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-for<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="comment">// v-text</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> message = <span class="string">"Hello World"</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> messagespan = <span class="string">"&lt;span&gt;Hello World&lt;/span&gt;"</span></span></span><br><span class="line"><span class="undefined">          </span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> spans = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"span"</span>)</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> span <span class="keyword">of</span> spans) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (span.textContent == <span class="string">"&#123;&#123; message &#125;&#125;"</span>) &#123;</span></span><br><span class="line"><span class="undefined">                    span.textContent = message</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// v-html</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">"container"</span>)</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> divs = container.getElementsByTagName(<span class="string">"div"</span>)</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> div <span class="keyword">of</span> divs)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (div.getAttribute(<span class="string">"v-html"</span>) == <span class="string">"messagespan"</span>) &#123;</span></span><br><span class="line"><span class="undefined">                    div.innerHTML = messagespan</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// v-model</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> inputs = container.getElementsByTagName(<span class="string">"input"</span>)</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> input <span class="keyword">of</span> inputs) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (input.getAttribute(<span class="string">"v-model"</span>) == <span class="string">"message"</span>) &#123;</span></span><br><span class="line"><span class="javascript">                    input.setAttribute(<span class="string">"value"</span>, message)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// v-on</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> myInput = <span class="built_in">document</span>.getElementById(<span class="string">"myInput"</span>)</span></span><br><span class="line"><span class="javascript">            myInput.onfocus = <span class="built_in">eval</span>(myInput.getAttribute(<span class="string">"v-on:focus"</span>))</span></span><br><span class="line"><span class="javascript">            myInput.onblur = <span class="built_in">eval</span>(myInput.getAttribute(<span class="string">"v-on:blur"</span>))</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="keyword">function</span> <span class="title">focus</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                myInput.setAttribute(<span class="string">"value"</span>, <span class="string">"focus"</span>)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="keyword">function</span> <span class="title">blur</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                myInput.setAttribute(<span class="string">"value"</span>, <span class="string">"blur"</span>)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// v-for</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> liContents = [</span></span><br><span class="line"><span class="javascript">                <span class="string">"jack"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"rose"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"james"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"wade"</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">"jordan"</span></span></span><br><span class="line"><span class="undefined">            ]</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> liElementList = []</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> content <span class="keyword">of</span> liContents) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>)</span></span><br><span class="line"><span class="xml">                li.innerHTML = `<span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>$&#123;content&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span>`</span></span><br><span class="line"><span class="undefined">                liElementList.push(li)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> ul = container.getElementsByTagName(<span class="string">"ul"</span>)[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> liEle <span class="keyword">of</span> liElementList) &#123;</span></span><br><span class="line"><span class="undefined">                ul.appendChild(liEle)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>点击<a href="https://jsfiddle.net/VioletJack/cpsrzbx5/5/" target="_blank" rel="noopener">此处</a>看效果。最后结果如图：<br><img src="https://upload-images.jianshu.io/upload_images/1987062-8c87d7451a8f3abf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="显示结果"></p>
<p>简单实现了 Vue.js 指令的这些功能，其实在 Vue.js 源码中也是用了这些 dom 操作的 api 来做的。<br>更多 Vue 源码中的 DOM 操作可以看下我的 <a href="https://www.jianshu.com/p/9db8eb16d76f" target="_blank" rel="noopener">《Vue.js 源码学习六 —— VNode虚拟DOM学习》</a>这篇文章中。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>无论什么框架，其实都是万变不离其宗。最终都是用最基础的 API 来实现的各种功能。所以学好基础知识是非常重要的~<br>PS：还是 MDN 靠谱，w3school 的资料虽然也挺多，但是感觉不是很靠谱……以后查资料尽量去 MDN 英文网站去查（中文网站翻译有些问题）。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/03/23/前端优化学习/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/23/前端优化学习/" class="post-title-link" itemprop="url">前端优化学习</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-03-23 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-23T00:00:00+08:00">2018-03-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2019-02-16 01:20:56" itemprop="dateModified" datetime="2019-02-16T01:20:56+08:00">2019-02-16</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>简单花了一些时间看了几篇前端优化的文章，文章作者写的都很详细。从中学到了不少东西。在这里就不班门弄斧的多讲了。只是在几篇文章的基础上一个小小的总结。</p>
</blockquote>
<h1 id="一些性能优化资料"><a href="#一些性能优化资料" class="headerlink" title="一些性能优化资料"></a>一些性能优化资料</h1><ul>
<li><a href="https://developer.yahoo.com/performance/rules.html" target="_blank" rel="noopener">Best Practices for Speeding Up Your Web Site</a></li>
<li><a href="https://github.com/wy-ei/notebook/issues/34" target="_blank" rel="noopener">前端性能优化相关</a></li>
<li><a href="https://github.com/Findow-team/Blog/issues/11" target="_blank" rel="noopener">2017前端性能优化清单</a></li>
<li><a href="https://segmentfault.com/a/1190000003646305" target="_blank" rel="noopener">前端性能优化指南</a></li>
<li>动物书：<a href="https://book.douban.com/subject/5362856/" target="_blank" rel="noopener">《高性能JavaScript》</a>、<a href="https://book.douban.com/subject/4719162/" target="_blank" rel="noopener">《高性能网站建设进阶指南》</a>、<a href="https://book.douban.com/subject/3132277/" target="_blank" rel="noopener">《高性能网站建设指南》</a></li>
</ul>
<h1 id="优化方法总结"><a href="#优化方法总结" class="headerlink" title="优化方法总结"></a>优化方法总结</h1><p>参照着这些资料，总结一下一些优化的知识点。</p>
<ul>
<li>减少 DOM 和 JavaScript 的交互。避免重复读写，而要先遍历读再遍历写。</li>
<li>使用 requireAnimationFrame 方法避免丢帧。</li>
<li>使用 debounce 和 throttle 进行节流和消抖，用于向滚动、重复触发的这类场景</li>
<li>CSS放头部，JavaScript 放底部。CSS需要在DOM显示前加载完，否则界面会没有样式一段时间。JavaScript 中可能有操作 DOM 行为，应该在 DOM 加载完后执行。</li>
<li>JavaScript 不慢，DOM 很慢。所以避免 DOM 大量渲染。<ul>
<li>PS：我之前做一个表单，三十几页内容，为了方便就将所有页面加载到 DOM 中，然后显示当前页隐藏其他页，卡的飞起。期初还以为是 JavaScript 逻辑计算卡住了呢。</li>
</ul>
</li>
<li>代码分包，优先加载核心业务。</li>
<li>JS 脚本合并</li>
<li>GPU硬件加速用于图层。</li>
<li>图片优化压缩，图片 lazyload 延时获取</li>
<li>利用 defer、async 属性异步加载脚本</li>
<li>合理使用缓存，将一些静态的东西使用缓存存本地，减少 HTTP 交互。</li>
<li>优化 HTTP 接口减少 HTTP 传输次数</li>
<li>优化结果的一些方面<ul>
<li>首屏加载</li>
<li>帧数每秒60帧</li>
<li>反应时间100毫秒</li>
</ul>
</li>
<li>理解DOM绘制和布局</li>
<li>使用 JSON 交换数据</li>
<li>高效使用 HTML 标签和 CSS 样式，好的写法能够减少性能的消耗。</li>
<li>CSS 和 JavaScript 的压缩合并。</li>
<li>图片优化：压缩图片、Base64图片、Sprite雪碧图</li>
<li>服务器渲染 SSR，在服务器端将页面加载完成传给客户端，可以减少首次加载的逻辑处理，加快首屏加载时间。<ul>
<li>这是由一定代价的，需要消耗更多的服务器资源，如果是大项目，可能需要加很多服务器来满足SSR。</li>
</ul>
</li>
<li>减少 cookie 大小，因为 cookie 会在每一次 HTTP 请求时被传输， cookie 的大小影响传输速度。</li>
</ul>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>其实，个人感觉：<strong>前端的优化理论上知道是一回事儿。真正要把优化玩好，还是需要在实际工作中不断去试错、实践、和解决问题，才能更快更好的去完成一个好的产品。</strong><br>本文记录下前端优化的一些知识点，便于之后工作中使用吧~</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/03/20/element-code-03/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/20/element-code-03/" class="post-title-link" itemprop="url">element 源码学习三 —— select 组件源码学习</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-03-20 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-20T00:00:00+08:00">2018-03-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-03-21 13:32:55" itemprop="dateModified" datetime="2018-03-21T13:32:55+08:00">2018-03-21</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>select 选择器是个比较复杂的组件了，通过不同的配置可以有多种用法。有必要单独学习学习。</p>
</blockquote>
<h1 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h1><p>以下是 select 的 template 结构，已去掉了一部分代码便于查看整体结构：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 多选 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-if</span>=<span class="string">"multiple"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ref</span>=<span class="string">"tags"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- collapse tags 多选时是否将选中值按文字的形式展示 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">"collapseTags &amp;&amp; selected.length"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-tag</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">"info"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">disable-transitions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"el-select__tags-text"</span>&gt;</span>&#123;&#123; selected[0].currentLabel &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-tag</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-tag</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-if</span>=<span class="string">"selected.length &gt; 1"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">"info"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">disable-transitions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"el-select__tags-text"</span>&gt;</span>+ &#123;&#123; selected.length - 1 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-tag</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 多选，多个 el-tag 组成 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transition-group</span> @<span class="attr">after-leave</span>=<span class="string">"resetInputHeight"</span> <span class="attr">v-if</span>=<span class="string">"!collapseTags"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-tag</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-for</span>=<span class="string">"item in selected"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:key</span>=<span class="string">"getValueKey(item)"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">"info"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">disable-transitions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"el-select__tags-text"</span>&gt;</span>&#123;&#123; item.currentLabel &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-tag</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">transition-group</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 可输入文本的查询框 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">"query"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-if</span>=<span class="string">"filterable"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ref</span>=<span class="string">"input"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 显示结果框 read-only --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ref</span>=<span class="string">"reference"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">"selectedLabel"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 用户显示清空和向下箭头 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"suffix"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 下拉菜单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transition</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-select-menu</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ref</span>=<span class="string">"popper"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-show</span>=<span class="string">"visible &amp;&amp; emptyText !== false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-scrollbar</span></span></span><br><span class="line"><span class="tag">          <span class="attr">tag</span>=<span class="string">"ul"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">wrap-class</span>=<span class="string">"el-select-dropdown__wrap"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">view-class</span>=<span class="string">"el-select-dropdown__list"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">ref</span>=<span class="string">"scrollbar"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-show</span>=<span class="string">"options.length &gt; 0 &amp;&amp; !loading"</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 默认项（创建条目） --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-option</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:value</span>=<span class="string">"query"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">created</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-if</span>=<span class="string">"showNewOption"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 插槽，用于放 option 和 option-group --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-scrollbar</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- loading 加载中文本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-if</span>=<span class="string">"emptyText &amp;&amp;</span></span></span><br><span class="line"><span class="tag"><span class="string">            (!allowCreate || loading || (allowCreate &amp;&amp; options.length === 0 ))"</span>&gt;</span></span><br><span class="line">          &#123;&#123; emptyText &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-select-menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>具体都写在注释中了~从上面内容中可以看到，select 考虑了很多情况，如单选、多选、搜索、下拉框、图标等等。并且使用 slot 插槽来获取开发者传递的 option 和 option-group 组件。<br>可以发现在 select 中使用了多个外部组件，也就是说 el-select 是由多个组件组装成的一个复杂组件~</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components</span></span><br><span class="line"><span class="keyword">import</span> ElInput <span class="keyword">from</span> <span class="string">'element-ui/packages/input'</span>;</span><br><span class="line"><span class="keyword">import</span> ElSelectMenu <span class="keyword">from</span> <span class="string">'./select-dropdown.vue'</span>;</span><br><span class="line"><span class="keyword">import</span> ElOption <span class="keyword">from</span> <span class="string">'./option.vue'</span>;</span><br><span class="line"><span class="keyword">import</span> ElTag <span class="keyword">from</span> <span class="string">'element-ui/packages/tag'</span>;</span><br><span class="line"><span class="keyword">import</span> ElScrollbar <span class="keyword">from</span> <span class="string">'element-ui/packages/scrollbar'</span>;</span><br></pre></td></tr></table></figure>
<h1 id="select-要实现的功能"><a href="#select-要实现的功能" class="headerlink" title="select 要实现的功能"></a>select 要实现的功能</h1><p>参照<a href="http://element-cn.eleme.io/#/zh-CN/component/select" target="_blank" rel="noopener">官方文档</a>的内容罗列出 select 的一些功能，后面跟上我对功能实现的理解：</p>
<ul>
<li>单选 —— 点击 <code>select</code> 弹出下拉框，点击 <code>option</code> 完成赋值。</li>
<li>禁用 —— <code>select</code> 和 <code>option</code> 都有 <code>disabled</code> 选项用于禁用。</li>
<li>清空 —— 如果 <code>select</code> 中有内容，鼠标悬浮在 <code>input</code> 上显示删除图标，点击执行删除操作。</li>
<li>多选（平铺展示和数字显示数量两种方式） —— 参数 model 变为数组，点击下拉菜单中的选项添加或删除数组中的值。</li>
<li>自定义模板 —— option 中定义了 <code>slot</code> 插槽，默认加了 <code>span</code> 显示内容。可以修改 <code>el-option</code> 标签中内容来自定义模板。</li>
<li>分组 —— 使用 option-group 组件来实现分组效果。</li>
<li>搜索 —— 通过正则匹配搜索项，不符合搜索项的控制 v-show 隐藏</li>
<li>创建条目 —— 在 <code>select</code> 中添加额外 <code>option</code>（一般 <code>option</code> 都是通过 <code>slot</code> 插槽传递的），如允许创建条目，则显示这条 <code>option</code> ,<code>option</code> 的内容显示为查询内容。</li>
</ul>
<h1 id="从几个问题去看源码逻辑"><a href="#从几个问题去看源码逻辑" class="headerlink" title="从几个问题去看源码逻辑"></a>从几个问题去看源码逻辑</h1><h2 id="如何实现基本单选功能？"><a href="#如何实现基本单选功能？" class="headerlink" title="如何实现基本单选功能？"></a>如何实现基本单选功能？</h2><p>分析下基本功能：点击 input，显示下拉菜单；鼠标选中一项 option，隐藏下拉菜单；input 中显示选中的结果。<br>所以这里看下显示内容的 input 都有些什么事件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@focus=&quot;handleFocus&quot; // 处理 焦点</span><br><span class="line">@blur=&quot;handleBlur&quot; // 处理 焦点 离开</span><br><span class="line">@keyup.native=&quot;debouncedOnInputChange&quot;</span><br><span class="line">@keydown.native.down.stop.prevent=&quot;navigateOptions(&apos;next&apos;)&quot; // 向下按键，移动到下一个 option</span><br><span class="line">@keydown.native.up.stop.prevent=&quot;navigateOptions(&apos;prev&apos;)&quot; // 向上按键，移动到上一个 option</span><br><span class="line">@keydown.native.enter.prevent=&quot;selectOption&quot; // 回车按键，选中option</span><br><span class="line">@keydown.native.esc.stop.prevent=&quot;visible = false&quot;  // esc按键，隐藏下拉框</span><br><span class="line">@keydown.native.tab=&quot;visible = false&quot; // tab按键，跳转到下一个文本框，隐藏下拉框</span><br><span class="line">@paste.native=&quot;debouncedOnInputChange&quot; // </span><br><span class="line">@mouseenter.native=&quot;inputHovering = true&quot; // mouse enter 事件</span><br><span class="line">@mouseleave.native=&quot;inputHovering = false&quot; // mouse leave 事件</span><br></pre></td></tr></table></figure></p>
<p>从上面的这些事件中可以知道：选中方法为 <code>selectOption</code>（从英文字面意思都能知道~）；显示下拉框通过 <code>visible</code> 属性控制；以及其他按键的一些功能。这里主要主要看看 <code>selectOption</code> 方法。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">selectOption() &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.visible) &#123;</span><br><span class="line">    <span class="keyword">this</span>.toggleMenu();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.options[<span class="keyword">this</span>.hoverIndex]) &#123;</span><br><span class="line">      <span class="keyword">this</span>.handleOptionSelect(<span class="keyword">this</span>.options[<span class="keyword">this</span>.hoverIndex]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>逻辑就是，如果下拉框未显示则执行 <code>toggleMenu</code> 方法触发下拉框，如果已显示下拉框则处理选择 option 的过程。看看这个 <code>toggleMenu</code> 方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">toggleMenu() &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.selectDisabled) &#123;</span><br><span class="line">    <span class="keyword">this</span>.visible = !<span class="keyword">this</span>.visible;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.visible) &#123;</span><br><span class="line">      (<span class="keyword">this</span>.$refs.input || <span class="keyword">this</span>.$refs.reference).focus();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>其实就是控制下拉菜单的显示和隐藏。如果显示的时候定焦在 <code>input</code> 和 <code>reference</code> 上，它们其实就是单选和多选的 input 框（多选 input 定义了 <code>ref=&quot;input&quot;</code> 单选 input 定义了 <code>ref=&quot;reference&quot;</code>）。<br>至此，下拉菜单的显示与隐藏解决了。然后我们去找 option 点击事件：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理选项选中事件</span></span><br><span class="line">handleOptionSelect(option) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.multiple) &#123;</span><br><span class="line">    <span class="comment">// 多选</span></span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">this</span>.value.slice();</span><br><span class="line">    <span class="keyword">const</span> optionIndex = <span class="keyword">this</span>.getValueIndex(value, option.value);</span><br><span class="line">    <span class="keyword">if</span> (optionIndex &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="comment">// 已选中，从数组中移除</span></span><br><span class="line">      value.splice(optionIndex, <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.multipleLimit &lt;= <span class="number">0</span> || value.length &lt; <span class="keyword">this</span>.multipleLimit) &#123;</span><br><span class="line">      <span class="comment">// 未选中，传入数组</span></span><br><span class="line">      value.push(option.value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.$emit(<span class="string">'input'</span>, value);</span><br><span class="line">    <span class="keyword">this</span>.emitChange(value);</span><br><span class="line">    <span class="keyword">if</span> (option.created) &#123;</span><br><span class="line">      <span class="keyword">this</span>.query = <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">this</span>.handleQueryChange(<span class="string">''</span>);</span><br><span class="line">      <span class="keyword">this</span>.inputLength = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查询</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.filterable) <span class="keyword">this</span>.$refs.input.focus();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 单选</span></span><br><span class="line">    <span class="keyword">this</span>.$emit(<span class="string">'input'</span>, option.value);</span><br><span class="line">    <span class="keyword">this</span>.emitChange(option.value);</span><br><span class="line">    <span class="keyword">this</span>.visible = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 渲染完成后</span></span><br><span class="line">  <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.scrollToOption(option);</span><br><span class="line">    <span class="keyword">this</span>.setSoftFocus();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>处理选中事件考虑了单选和多选两种情况。<br>如果是多选，检索选中 option 是否在 <code>value</code> 数组中，有则移除、无则添加到 <code>value</code> 数组中。然后 <code>$emit</code> 触发 <code>input</code> 事件，执行 <code>emitChange</code> 方法。如果 option 的 <code>created</code> 为 true，则清空查询内容。<br>如果是单选，<code>$emit</code> 触发 <code>input</code> 事件将选中值传递给父组件，执行 <code>emitChange</code> 方法，最后隐藏下拉菜单。<br>最后使用 <code>$nextTick</code> 方法处理下界面。<br>到这里，选中 option 后下拉菜单消失问题解决，只剩下显示结果到 input 中了。这个显示结果的过程是通过对 <code>visible</code> 属性的监听来完成的（一开始以为在 <code>emitChange</code> 结果发现那只是触发改变事件的）。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">visible(val) &#123;</span><br><span class="line">  <span class="comment">// 在下拉菜单隐藏时</span></span><br><span class="line">  <span class="keyword">if</span> (!val) &#123;</span><br><span class="line">    <span class="comment">// 处理图标</span></span><br><span class="line">    <span class="keyword">this</span>.handleIconHide();</span><br><span class="line">    <span class="comment">// 广播下拉菜单销毁事件</span></span><br><span class="line">    <span class="keyword">this</span>.broadcast(<span class="string">'ElSelectDropdown'</span>, <span class="string">'destroyPopper'</span>);</span><br><span class="line">    <span class="comment">// 取消焦点</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.$refs.input) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$refs.input.blur();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重置过程</span></span><br><span class="line">    <span class="keyword">this</span>.query = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">this</span>.previousQuery = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.selectedLabel = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">this</span>.inputLength = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">this</span>.resetHoverIndex();</span><br><span class="line">    <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.$refs.input &amp;&amp;</span><br><span class="line">        <span class="keyword">this</span>.$refs.input.value === <span class="string">''</span> &amp;&amp;</span><br><span class="line">        <span class="keyword">this</span>.selected.length === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.currentPlaceholder = <span class="keyword">this</span>.cachedPlaceHolder;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 如果不是多选，进行赋值现在 input 中</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.multiple) &#123;</span><br><span class="line">      <span class="comment">// selected 为当前选中的 option</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.selected) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.filterable &amp;&amp; <span class="keyword">this</span>.allowCreate &amp;&amp;</span><br><span class="line">          <span class="keyword">this</span>.createdSelected &amp;&amp; <span class="keyword">this</span>.createdOption) &#123;</span><br><span class="line">          <span class="keyword">this</span>.selectedLabel = <span class="keyword">this</span>.createdLabel;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.selectedLabel = <span class="keyword">this</span>.selected.currentLabel;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 查询结果</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.filterable) <span class="keyword">this</span>.query = <span class="keyword">this</span>.selectedLabel;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 下拉菜单显示</span></span><br><span class="line">    <span class="comment">// 处理图片显示</span></span><br><span class="line">    <span class="keyword">this</span>.handleIconShow();</span><br><span class="line">    <span class="comment">// 广播下拉菜单更新事件</span></span><br><span class="line">    <span class="keyword">this</span>.broadcast(<span class="string">'ElSelectDropdown'</span>, <span class="string">'updatePopper'</span>);</span><br><span class="line">    <span class="comment">// 处理查询事件</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.filterable) &#123;</span><br><span class="line">      <span class="keyword">this</span>.query = <span class="keyword">this</span>.remote ? <span class="string">''</span> : <span class="keyword">this</span>.selectedLabel;</span><br><span class="line">      <span class="keyword">this</span>.handleQueryChange(<span class="keyword">this</span>.query);</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.multiple) &#123;</span><br><span class="line">        <span class="keyword">this</span>.$refs.input.focus();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.remote) &#123;</span><br><span class="line">          <span class="keyword">this</span>.broadcast(<span class="string">'ElOption'</span>, <span class="string">'queryChange'</span>, <span class="string">''</span>);</span><br><span class="line">          <span class="keyword">this</span>.broadcast(<span class="string">'ElOptionGroup'</span>, <span class="string">'queryChange'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.broadcast(<span class="string">'ElInput'</span>, <span class="string">'inputSelect'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 触发 visible-change 事件</span></span><br><span class="line">  <span class="keyword">this</span>.$emit(<span class="string">'visible-change'</span>, val);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>从 template 中可知，显示结果的 input 绑定的 <code>v-model</code> 是 <code>selectedLabel</code>，而 select 是通过获取下拉菜单的显示与隐藏事件来执行结果显示部分的功能的。最终 <code>selectedLabel</code> 获得到了选中的 option 的 <code>label</code> 内容。<br>这样，从 <strong>点击-单选-显示</strong> 的流程就实现了。还是很简单的。</p>
<h2 id="如何实现多选，多选选中后-option-右侧的勾以及-input-中的-tag-如何显示？"><a href="#如何实现多选，多选选中后-option-右侧的勾以及-input-中的-tag-如何显示？" class="headerlink" title="如何实现多选，多选选中后 option 右侧的勾以及 input 中的 tag 如何显示？"></a>如何实现多选，多选选中后 option 右侧的勾以及 input 中的 tag 如何显示？</h2><p>关于多选，在刚才讲单选的时候提及了一些了。所以有些代码就不贴出浪费篇幅了。具体逻辑如下：<br>先点击 input 执行 <code>selectOption</code> 方法显示下拉菜单，然后点击下拉菜单中的 option，执行 <code>handleOptionSelect</code> 方法将 option 的值都传给 <code>value</code> 数组。此时 <code>value</code> 数组改变，触发 watch 中的 <code>value</code> 变化监听方法。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">value(val) &#123;</span><br><span class="line">  <span class="comment">// 多选</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.multiple) &#123;</span><br><span class="line">    <span class="keyword">this</span>.resetInputHeight();</span><br><span class="line">    <span class="keyword">if</span> (val.length &gt; <span class="number">0</span> || (<span class="keyword">this</span>.$refs.input &amp;&amp; <span class="keyword">this</span>.query !== <span class="string">''</span>)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.currentPlaceholder = <span class="string">''</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.currentPlaceholder = <span class="keyword">this</span>.cachedPlaceHolder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.filterable &amp;&amp; !<span class="keyword">this</span>.reserveKeyword) &#123;</span><br><span class="line">      <span class="keyword">this</span>.query = <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">this</span>.handleQueryChange(<span class="keyword">this</span>.query);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.setSelected();</span><br><span class="line">  <span class="comment">// 非多选查询</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.filterable &amp;&amp; !<span class="keyword">this</span>.multiple) &#123;</span><br><span class="line">    <span class="keyword">this</span>.inputLength = <span class="number">20</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>以上代码关键是执行了 <code>setSelected</code> 方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置选择项</span></span><br><span class="line">setSelected() &#123;</span><br><span class="line">  <span class="comment">// 单选</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.multiple) &#123;</span><br><span class="line">    <span class="keyword">let</span> option = <span class="keyword">this</span>.getOption(<span class="keyword">this</span>.value);</span><br><span class="line">    <span class="comment">// created 是指创建出来的 option，这里指 allow-create 创建的 option 项</span></span><br><span class="line">    <span class="keyword">if</span> (option.created) &#123;</span><br><span class="line">      <span class="keyword">this</span>.createdLabel = option.currentLabel;</span><br><span class="line">      <span class="keyword">this</span>.createdSelected = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.createdSelected = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.selectedLabel = option.currentLabel;</span><br><span class="line">    <span class="keyword">this</span>.selected = option;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.filterable) <span class="keyword">this</span>.query = <span class="keyword">this</span>.selectedLabel;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 遍历获取 option</span></span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(<span class="keyword">this</span>.value)) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value.forEach(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      result.push(<span class="keyword">this</span>.getOption(value));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 赋值</span></span><br><span class="line">  <span class="keyword">this</span>.selected = result;</span><br><span class="line">  <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 重置 input 高度</span></span><br><span class="line">    <span class="keyword">this</span>.resetInputHeight();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>可以看到如果是多选，那么将 <code>value</code> 数组遍历，获取相应的 <code>option</code> 值，传给 <code>selected</code>。而多选界面其实就是对于这个 <code>selected</code> 的 v-for 遍历显示。显示的标签使用的是 element 的另外一个组件 <a href="http://element-cn.eleme.io/#/zh-CN/component/tag" target="_blank" rel="noopener">el-tag</a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-tag</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">"item in selected"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">"getValueKey(item)"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"el-select__tags-text"</span>&gt;</span>&#123;&#123; item.currentLabel &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-tag</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里顺便提一句： option 的 <code>created</code> 参数用于标识是 <code>select</code> 组件中创建的那个用于创建条目的 <code>option</code>。而从 slot 插槽传入的 option 是不用传 <code>created</code> 参数的。</p>
<h2 id="如何实现搜索功能？"><a href="#如何实现搜索功能？" class="headerlink" title="如何实现搜索功能？"></a>如何实现搜索功能？</h2><p>从 template 中可知，select 有两个 input，一个用于显示结果，一个则用于查询搜索。我们来看下搜索内容的 input 文本框如何实现搜索功能：<br>在 input 中有 <code>@input=&quot;e =&gt; handleQueryChange(e.target.value)&quot;</code>这么一段代码。所以，handleQueryChange 方法就是关键所在了。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理查询改变</span></span><br><span class="line">handleQueryChange(val) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.previousQuery === val) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="keyword">this</span>.previousQuery === <span class="literal">null</span> &amp;&amp;</span><br><span class="line">    (<span class="keyword">typeof</span> <span class="keyword">this</span>.filterMethod === <span class="string">'function'</span> || <span class="keyword">typeof</span> <span class="keyword">this</span>.remoteMethod === <span class="string">'function'</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">this</span>.previousQuery = val;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.previousQuery = val;</span><br><span class="line">  <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.visible) <span class="keyword">this</span>.broadcast(<span class="string">'ElSelectDropdown'</span>, <span class="string">'updatePopper'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">this</span>.hoverIndex = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.multiple &amp;&amp; <span class="keyword">this</span>.filterable) &#123;</span><br><span class="line">    <span class="keyword">const</span> length = <span class="keyword">this</span>.$refs.input.value.length * <span class="number">15</span> + <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">this</span>.inputLength = <span class="keyword">this</span>.collapseTags ? <span class="built_in">Math</span>.min(<span class="number">50</span>, length) : length;</span><br><span class="line">    <span class="keyword">this</span>.managePlaceholder();</span><br><span class="line">    <span class="keyword">this</span>.resetInputHeight();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.remote &amp;&amp; <span class="keyword">typeof</span> <span class="keyword">this</span>.remoteMethod === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hoverIndex = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">this</span>.remoteMethod(val);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.filterMethod === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.filterMethod(val);</span><br><span class="line">    <span class="keyword">this</span>.broadcast(<span class="string">'ElOptionGroup'</span>, <span class="string">'queryChange'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.filteredOptionsCount = <span class="keyword">this</span>.optionsCount;</span><br><span class="line">    <span class="keyword">this</span>.broadcast(<span class="string">'ElOption'</span>, <span class="string">'queryChange'</span>, val);</span><br><span class="line">    <span class="keyword">this</span>.broadcast(<span class="string">'ElOptionGroup'</span>, <span class="string">'queryChange'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.defaultFirstOption &amp;&amp; (<span class="keyword">this</span>.filterable || <span class="keyword">this</span>.remote) &amp;&amp; <span class="keyword">this</span>.filteredOptionsCount) &#123;</span><br><span class="line">    <span class="keyword">this</span>.checkDefaultFirstOption();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>其中，<code>remoteMethod</code> 和 <code>filterMethod</code> 方法是自定义的远程查询和本地过滤方法。如果没有自定义的这两个方法，则会触发广播给 <code>option</code> 和 <code>option-group</code> 组件 <code>queryChange</code> 方法。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// option.vue</span></span><br><span class="line">queryChange(query) &#123;</span><br><span class="line">  <span class="keyword">let</span> parsedQuery = <span class="built_in">String</span>(query).replace(<span class="regexp">/(\^|\(|\)|\[|\]|\$|\*|\+|\.|\?|\\|\&#123;|\&#125;|\|)/g</span>, <span class="string">'\\$1'</span>);</span><br><span class="line">  <span class="comment">// 匹配字符决定是否显示当前option</span></span><br><span class="line">  <span class="keyword">this</span>.visible = <span class="keyword">new</span> <span class="built_in">RegExp</span>(parsedQuery, <span class="string">'i'</span>).test(<span class="keyword">this</span>.currentLabel) || <span class="keyword">this</span>.created;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.visible) &#123;</span><br><span class="line">    <span class="keyword">this</span>.select.filteredOptionsCount--;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>option 中通过正则匹配决定是否隐藏当前 option 组件，而 option-group 通过获取子组件，判断如果有子组件是可见的则显示，否则隐藏。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// option-group.vue</span></span><br><span class="line">queryChange() &#123;</span><br><span class="line">  <span class="keyword">this</span>.visible = <span class="keyword">this</span>.$children &amp;&amp;</span><br><span class="line">    <span class="built_in">Array</span>.isArray(<span class="keyword">this</span>.$children) &amp;&amp;</span><br><span class="line">    <span class="keyword">this</span>.$children.some(<span class="function"><span class="params">option</span> =&gt;</span> option.visible === <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>所以，其实 option 和 option-group 在搜索的时候只是隐藏掉了不匹配的内容而已。</p>
<h2 id="下拉菜单的显示和隐藏效果是如何实现的？下拉菜单本质是什么东西？"><a href="#下拉菜单的显示和隐藏效果是如何实现的？下拉菜单本质是什么东西？" class="headerlink" title="下拉菜单的显示和隐藏效果是如何实现的？下拉菜单本质是什么东西？"></a>下拉菜单的显示和隐藏效果是如何实现的？下拉菜单本质是什么东西？</h2><p>下拉菜单是通过 <a href="https://cn.vuejs.org/v2/api/#transition" target="_blank" rel="noopener">transition</a> 来实现过渡动画的。<br>下拉菜单 <code>el-select-menu</code> 本质上就是一个 div 容器而已。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">"el-select-dropdown el-popper"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:class</span>=<span class="string">"[&#123; 'is-multiple': $parent.multiple &#125;, popperClass]"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">"&#123; minWidth: minWidth &#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>另外，在代码中经常出现的通知下拉菜单显示和隐藏的广播在 <code>el-select-menu</code> 的 <code>mounted</code> 方法中接收使用：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">  <span class="keyword">this</span>.referenceElm = <span class="keyword">this</span>.$parent.$refs.reference.$el;</span><br><span class="line">  <span class="keyword">this</span>.$parent.popperElm = <span class="keyword">this</span>.popperElm = <span class="keyword">this</span>.$el;</span><br><span class="line">  <span class="keyword">this</span>.$on(<span class="string">'updatePopper'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.$parent.visible) <span class="keyword">this</span>.updatePopper();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">this</span>.$on(<span class="string">'destroyPopper'</span>, <span class="keyword">this</span>.destroyPopper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="创建条目如何实现？"><a href="#创建条目如何实现？" class="headerlink" title="创建条目如何实现？"></a>创建条目如何实现？</h2><p>上文中提到过，就是在 select 中默认藏了一条 option，当创建条目时显示这个 option 并显示创建内容。点击这个 option 就可以把创建的内容添加到显示结果的 input 上了。</p>
<h2 id="如何展示远程数据？"><a href="#如何展示远程数据？" class="headerlink" title="如何展示远程数据？"></a>如何展示远程数据？</h2><p>通过为 select 设置 <code>remote</code> 和 <code>remote-method</code> 属性来获取远程数据。<code>remote-method</code> 方法最终将数据赋值给 option 的 v-model 绑定数组数据将结果显示出来即可。</p>
<h2 id="清空按钮显示和点击事件呢？"><a href="#清空按钮显示和点击事件呢？" class="headerlink" title="清空按钮显示和点击事件呢？"></a>清空按钮显示和点击事件呢？</h2><p>在显示结果的 input 文本框中有一个 <code>&lt;i&gt;</code> 标签，用于显示图标。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 用户显示清空和向下箭头 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"suffix"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">:class</span>=<span class="string">"['el-select__caret', 'el-input__icon', 'el-icon-' + iconClass]"</span></span></span><br><span class="line"><span class="tag"> @<span class="attr">click</span>=<span class="string">"handleIconClick"</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>最终 input 右侧显示什么图标由 <code>iconClass</code> 决定，其中 <code>circle-close</code> 就是圆形查查，即清空按钮~<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">iconClass() &#123;</span><br><span class="line">  <span class="keyword">let</span> criteria = <span class="keyword">this</span>.clearable &amp;&amp;</span><br><span class="line">    !<span class="keyword">this</span>.selectDisabled &amp;&amp;</span><br><span class="line">    <span class="keyword">this</span>.inputHovering &amp;&amp;</span><br><span class="line">    !<span class="keyword">this</span>.multiple &amp;&amp;</span><br><span class="line">    <span class="keyword">this</span>.value !== <span class="literal">undefined</span> &amp;&amp;</span><br><span class="line">    <span class="keyword">this</span>.value !== <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">return</span> criteria ? <span class="string">'circle-close is-show-close'</span> : (<span class="keyword">this</span>.remote &amp;&amp; <span class="keyword">this</span>.filterable ? <span class="string">''</span> : <span class="string">'arrow-up'</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p><code>handleIconClick</code> 方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理图标点击事件（删除按钮）</span></span><br><span class="line">handleIconClick(event) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.iconClass.indexOf(<span class="string">'circle-close'</span>) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.deleteSelected(event);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 删除选中</span></span><br><span class="line">deleteSelected(event) &#123;</span><br><span class="line">  event.stopPropagation();</span><br><span class="line">  <span class="keyword">this</span>.$emit(<span class="string">'input'</span>, <span class="string">''</span>);</span><br><span class="line">  <span class="keyword">this</span>.emitChange(<span class="string">''</span>);</span><br><span class="line">  <span class="keyword">this</span>.visible = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">this</span>.$emit(<span class="string">'clear'</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>最终，清空只是将文本清空掉并且关闭下拉菜单。其实当再次打开 select 的时候，option 还是选中在之前选中的那个位置，即 <code>HoverIndex</code> 没有变为 -1，不知道算不算 bug。</p>
<h2 id="option-的自定义模板是如何实现的？"><a href="#option-的自定义模板是如何实现的？" class="headerlink" title="option 的自定义模板是如何实现的？"></a>option 的自定义模板是如何实现的？</h2><p>很简单，使用了 slot 插槽。并且在 slot 中定义了默认显示方式。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; currentLabel &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>第一次尝试用问题取代主题来写博客，这样看着中心是不是更明确一些？<br>最后，说下看完 select 组件的感受：</p>
<ul>
<li>element 通过自定义的广播方法进行父子组件间的通信。（好像以前Vue也有这个功能，后来弃用了。）</li>
<li>再复杂的组件都是由一个个基础的组件拼起来的。</li>
<li>select 功能还是挺复杂的，加上子组件 1000+ 行代码了。本文只是讲了基本功能的实现，值得深入学习。</li>
<li>学习了高手写组件的方式和写法~之后在自己写组件的时候可以参考。</li>
<li>方法、参数命名非常规范，一眼就能看懂具体用法。</li>
<li>知道了 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some" target="_blank" rel="noopener">Array.some()</a> 方法~</li>
</ul>
<p>好吧，说好了一天写出来，结果断断续续花了三天才完成。有点高估自己能力啦~<br>说下之后的Vue实验室博客计划：计划再找两个复杂的 element 组件来学习，最后写一篇总结博客。然后试着自己去创建几个 UI 组件，学以致用。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/03/17/HTTP 协议学习笔记（扫盲文）/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/17/HTTP 协议学习笔记（扫盲文）/" class="post-title-link" itemprop="url">HTTP 协议学习笔记（扫盲文）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-17T00:00:00+08:00">2018-03-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2019-02-16 01:20:56" itemprop="dateModified" datetime="2019-02-16T01:20:56+08:00">2019-02-16</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作为一个前端，了解下 HTTP 协议是很有必要的。</p>
</blockquote>
<p>先说个题外话，从《跃迁》一书中提到，高手获取信息的方式 —— 只获取一手、二手资料。<br>我在学习 HTTP 协议的时候犯了的毛病是 —— 百度了一堆 HTTP 相关文章，内容不一、质量参差不齐，看得云里雾里。最后干脆去Google查 HTTP，发现在 MDN 上有详细的 HTTP 相关资料，于是抛弃三手、四手资料，直接去看 MDN 上的内容。<br>所以学习知识，必须得先认清资料的来源和专业程度，在知识源头学习可以提高学习的效率和准确性。</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><blockquote>
<p><strong>HTTP是一种能够获取如 HTML 这样的网络资源的 </strong><a href="https://developer.mozilla.org/en-US/docs/Glossary/protocol" title="protocol: A protocol is a system of rules that define how data is exchanged within or between computers.  Communications between devices require that the devices agree on the format of the data that is being exchanged. The set of rules that defines a format is called a protocol." target="_blank" rel="noopener">protocol</a>(通讯协议)。<strong>它是在 Web 上进行数据交换的基础，是一种 client-server 协议，也就是说，请求通常是由像浏览器这样的接受方发起的。一个完整的Web文档通常是由不同的子文档拼接而成的，像是文本、布局描述、图片、视频、脚本等等。</strong></p>
</blockquote>
<p>这里加上我个人的理解：HTTP 是一种在客户端和服务端之间传输信息的传输协议，或者说是一整套传输方案。所以，像 Headers、Cookie、Methods 等都是 HTTP 协议中的内容。用于更好的解决 client-server 传输信息中遇到的各种问题。</p>
<p>关于HTTP的更多历史信息，可以看到阮一峰老师的<a href="http://www.ruanyifeng.com/blog/2016/08/http.html" target="_blank" rel="noopener">HTTP 协议入门</a>（阮一峰老师写的文章还是那么清晰明了，向老师学习！）。</p>
<h1 id="TCP-IP-三次握手"><a href="#TCP-IP-三次握手" class="headerlink" title="TCP/IP 三次握手"></a>TCP/IP 三次握手</h1><p>HTTP 的传输协议是 TCP/IP 协议，该协议连接是需要进行三次握手的。<br>那么为什么必须是三次？</p>
<blockquote>
<p>这个问题的本质是：信道不可靠，但是通信双发需要就某个问题达成一致。而要解决这个问题，无论你在消息中包含什么信息，三次通信是理论上的最小值。所以三次握手不是TCP本身的要求，而是为了满足”在不可靠信道上可靠地传输信息”这一需求所导致的。</p>
</blockquote>
<p>以下列出三次握手具体步骤与理解：</p>
<ul>
<li>客户端发送 SYN 报文给服务器端，进入 SYN_SEND 状态。 —— 客户端向服务器端发送消息，请求它的回应。</li>
<li>服务器收到 SYN 报文，回应一个 SYN ACK 报文，进入 SYN_RECV 状态。 —— 服务器端收到消息，采取回应行为，回复消息告诉客户端收到了。</li>
<li>客户端收到服务器 SYN 报文，回应一个 ACK 报文，进入连接状态。 —— 客户端收到消息，这时客户端收到响应，表明发送的数据有回信了。但是服务器端发送了回应却还不知道客户端有没有收到。这时客户端需要再次发送消息告诉服务器我收到了。服务器收到消息后，客户端和服务器都知道对方已准备好通讯，然后就开始连接通讯了。</li>
</ul>
<h1 id="HTTP-的请求-request-和响应-response"><a href="#HTTP-的请求-request-和响应-response" class="headerlink" title="HTTP 的请求(request)和响应(response)"></a>HTTP 的请求(request)和响应(response)</h1><h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p>请求为客户端发送给服务器的数据。具体有如下数据：</p>
<ul>
<li>请求方法：如 GET、 POST 这类请求方法。</li>
<li>要获取的资源路径。</li>
<li>HTTP协议版本号。</li>
<li>Headers：传递附加信息。</li>
<li>body：如果想 POST 请求，就会传递 body 资源数据给服务器。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/1987062-91b2abd5c2ae7063.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Request"></p>
<h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>响应为服务器收到客户端发送数据返回的数据，具体有如下数据：</p>
<ul>
<li>HTTP协议版本号。</li>
<li>状态码（status code）：告知请求是否成功以及失败原因。</li>
<li>状态消息（status message）：非权威状态码信息，由服务器自行设定。</li>
<li>Headers：传递附加信息。</li>
<li>body： 响应返回的资源存在body中。一般返回图片、HTML等资源。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/1987062-f554dd2fc23359f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Response"></p>
<h1 id="Headers-头文件"><a href="#Headers-头文件" class="headerlink" title="Headers 头文件"></a>Headers 头文件</h1><p>头文件允许客户端和服务器通过请求和响应传递附加信息。<br>下面列出一些常用的消息头及其用法：</p>
<ul>
<li>Date 信息来源的日期时间</li>
<li>Content-Type 指定服务器文档的MIME类型，帮助用户代理去处理接收到的数据。</li>
<li>Content-Length 表示 body 的字节长度。</li>
<li>Host 服务器的域名。</li>
<li>User-Agent 可以用来识别发送请求的浏览器，是产品标记符和注释的清单。</li>
<li>Accept 用户代理期望的MIME类型列表</li>
<li>Accept-Encoding 列出用户代理支持的压缩方法</li>
<li>Accept-Ranges 期望范围。参数：byte、none。</li>
<li>Assess-Control-Allow-Origin 允许组织连接控制 。</li>
<li>Age 对象在代理缓存中的时间</li>
<li>Cache-Control 指定缓存机制</li>
<li>Connection 是否保持网络连接打开状态。参数：keep-alive、close。</li>
<li>ETag 特定版本资源标识符</li>
<li>Expires 过期时间日期</li>
<li>Server 服务器信息，如JSP、Apache等。</li>
<li>Referer 可用于识别用户访问位置</li>
</ul>
<p>还有一些自定专用消息头可通过 <code>X-</code> 前缀来添加。如 <code>x-oss-object-type</code>。</p>
<h1 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h1><p>状态码是由服务器端发送的响应中带有的请求结果的信息码。可以分为以下几类：</p>
<ul>
<li>1** 信息响应</li>
<li>2** 成功响应</li>
<li>3** 重定向</li>
<li>4** 客户端响应</li>
<li>5** 服务器响应</li>
</ul>
<p>列一些常见的状态返回码：</p>
<ul>
<li>200 请求成功。</li>
<li>304 未修改。</li>
<li>401 当前请求需要用户验证。</li>
<li>404 未找到资源。</li>
<li>500 服务器内部错误，无法完成请求。</li>
</ul>
<p>状态码其实只要了解常用的，冷门的遇到的时候查查 MDN 就好了。</p>
<h1 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h1><p>Cookie 是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器发起请求时被懈怠并发送到服务器上。<br>HTTP 本质上无状态，使用 Cookie 可以创建有状态会话。服务器指定 Cookie 后，浏览器的每次请求都会携带 Cookie 数据。所以，Cookie 常被用来验证用户登录信息。<br>更多 Cookie 内容请看 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies</a></p>
<h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><p>跨域就是获取不同域名下服务器的数据。跨域对于 GET 请求没有影响。对于其他请求，会先发送一个 OPTIONS 方法发送一个预检请求，获知服务端是否允许跨域请求。<br>所以，之前遇到 POST 方法请求变为 OPTIONS 请求报错的问题就是跨域问题。<br>在 Express 中也遇到个跨域问题，最终使用 <code>$ npm install cors</code> 的方式解决了。 </p>
<h1 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h1><h2 id="HTTP-和-HTTPS-的区别"><a href="#HTTP-和-HTTPS-的区别" class="headerlink" title="HTTP 和 HTTPS 的区别"></a>HTTP 和 HTTPS 的区别</h2><p>因为 HTTP 所封装的信息是明文的，通过抓包工具可以分析其信息内容。所以 HTTP 是及其不安全的。<br>而 HTTPS 在 HTTP 传输协议的基础上加上了 SSL/TLS 加密协议，所以传输的信息都是加密过的。不易被截获信息内容。所以 HTTPS 比 HTTP 安全性更高。</p>
<h2 id="HTTPS-运行机制"><a href="#HTTPS-运行机制" class="headerlink" title="HTTPS 运行机制"></a>HTTPS 运行机制</h2><p>大致运行步骤如下：</p>
<ol>
<li>客户端发起 HTTPS 请求</li>
<li>服务端获取数字证书CA —— 服务器向数字证书认证机构申请获取数字证书 CA 表明服务器是合法的、无害的。</li>
<li>传送数字证书 —— 将数字证书传给客户端</li>
<li>客户端解析证书 —— 客户端向数字证书认证机构查询，验证服务器合法性。</li>
<li>客户端传输加密后信息给服务端</li>
<li>服务端解密信息</li>
<li>服务端传输加密后的信息给客户端</li>
<li>客户端解密信息</li>
</ol>
<h2 id="常见加密算法"><a href="#常见加密算法" class="headerlink" title="常见加密算法"></a>常见加密算法</h2><p>非对称加密算法：RSA，DSA/DSS<br>对称加密算法：AES，RC4，3DES<br>HASH算法：MD5，SHA1，SHA256</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>发现网上写 HTTP 协议的文章很多，但是众口不一，每篇博客的内容都有所不同，搜集资料的时候还是蛮困惑的。<br>本文整理了一些 HTTP 的基础知识，写的不够详细。更加深入的学习通过查 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener">MDN</a> 来解决问题啦~</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>MDN <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP</a></li>
<li>通俗大白话来理解TCP协议的三次握手和四次分手<a href="https://github.com/jawil/blog/issues/14" target="_blank" rel="noopener">https://github.com/jawil/blog/issues/14</a></li>
<li>https原理：证书传递、验证和数据加密、解密过程解析<br><a href="http://blog.csdn.net/clh604/article/details/22179907" target="_blank" rel="noopener">http://blog.csdn.net/clh604/article/details/22179907</a></li>
</ul>
<h1 id="更新内容"><a href="#更新内容" class="headerlink" title="更新内容"></a>更新内容</h1><p>本文只是 HTTP 的扫盲文，并没有深入学习 HTTP 的意思，其实深入学习 HTTP 水还是很深的。换位思考，我感觉面试官问 HTTP 相关问题的主要目的是：<strong>能够很好与后端工程师沟通接口问题；更好处理前端工作中网络传输的问题；保证项目的信息安全；</strong>前端工程师作为客户端方的开发，也有必要和服务器端的后端工程师合作将程序开发的高效、安全、易维护。<br>–03-19更新–<br>我去问了一位前辈前端为什么要学习 HTTP 协议，大牛前辈的回答是这样的：“<strong>就前端来讲，两个用处吧：前端性能优化必须掌握，排障必须掌握</strong>”</p>
<p>感觉这篇文章内容实在少了点。所以又补充了点内容，贴上几条最靠谱的 HTTP 学习资料希望能够帮到一些想深入学习 HTTP 童鞋~</p>
<ul>
<li><a href="https://item.jd.com/11056556.html?dist=jd" target="_blank" rel="noopener">《HTTP权威指南》</a>（京东）</li>
<li><a href="https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">超文本传输协议 —— 维基百科</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener">HTTP | MDN</a></li>
</ul>
<p>记住文章开头所讲的，只去源头的知识学习才能保证学习的效率和准确性~祝我们能够更快更好的学习技术知识。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://violetjack.github.io/2018/03/14/element-code-extra/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VioletJack"/>
      <meta itemprop="description" content="Violetjack 的个人博客，记录了一些技术笔记和思考。"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VioletJack 技术日志"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/14/element-code-extra/" class="post-title-link" itemprop="url">element 源码学习（番外篇） —— SASS 五分钟快速入门</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Post created: 2018-03-14 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-14T00:00:00+08:00">2018-03-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Updated at: 2018-03-21 13:33:03" itemprop="dateModified" datetime="2018-03-21T13:33:03+08:00">2018-03-21</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>这算是 element 源码学习的番外篇，因为 element 中使用了大量 sass 来写样式。而 UI 框架的核心其实就是样式。所以，抽空把 sass 学了一遍，写了些小 demo 实践，总结成此文。</p>
</blockquote>
<h1 id="SASS-安装和调试"><a href="#SASS-安装和调试" class="headerlink" title="SASS 安装和调试"></a>SASS 安装和调试</h1><p>简单说下 sass 如何安装和编译调试。<br>参照<a href="http://sass-lang.com/install" target="_blank" rel="noopener">官网</a>，需要使用 gem 来安装 sass。如果是windows用户没有 gem 需要先安装 <a href="https://rubyinstaller.org/" target="_blank" rel="noopener">Ruby</a><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> gem install sass</span><br></pre></td></tr></table></figure></p>
<p>如果有权限问题，需要加上 <code>sudo</code> 。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo gem install sass</span><br></pre></td></tr></table></figure></p>
<p>最后，通过查询 sass 版本号验证是否安装成功。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sass -v</span><br></pre></td></tr></table></figure></p>
<p>编译命令很简单，在项目目录下编译选中 <code>.scss</code>、<code>.sass</code> 文件即可。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sass hello.scss hello.css</span><br></pre></td></tr></table></figure></p>
<p>如果是学习 sass 这一个命令足矣，其他命令可参考<a href="https://www.w3cplus.com/sassguide/compile.html" target="_blank" rel="noopener">sass 编译</a></p>
<h1 id="语法简述"><a href="#语法简述" class="headerlink" title="语法简述"></a>语法简述</h1><p>下面我用自己对 sass 语法的理解，配合上 demo 快速过一遍 sass 基础语法。</p>
<h2 id="sass-文件和-scss-文件区别"><a href="#sass-文件和-scss-文件区别" class="headerlink" title="sass 文件和 scss 文件区别"></a>sass 文件和 scss 文件区别</h2><p>两者其实都是 sass 可以识别的文件，唯一不同点是 <code>.sass</code> 文件不使用大括号和分号。如下~<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// .scss</span><br><span class="line">$default-color: #FFAACC;</span><br><span class="line">.selected &#123;</span><br><span class="line">    color: $default-color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// .sass</span><br><span class="line">$default-color: #FFAACC</span><br><span class="line">.selected </span><br><span class="line">    color: $default-color</span><br><span class="line"></span><br><span class="line">// .css</span><br><span class="line">.selected &#123;</span><br><span class="line">  color: #FFAACC; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>官方文档推荐使用 <code>.scs</code>s 文件类型写法，避免 <code>.sass</code> 文件的严格格式要求报错。</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>通过 <code>$</code> 符号来定义 sass 变量，变量在样式内外都可定义，用于各个样式中。定义的变量不会在编译后的 CSS 文件中显示。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$default-color: #FFAACC;</span><br><span class="line">$border-color: #AAFFCC;</span><br><span class="line">$default-border:  1px solid $border-color;</span><br><span class="line">$extra-color: #BBDD00;</span><br><span class="line"></span><br><span class="line">.selected &#123;</span><br><span class="line">    $scoped-width: 60px;</span><br><span class="line">    width: $scoped-width;</span><br><span class="line">    color: $default-color;</span><br><span class="line">    border: $default-border;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译结果：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.selected</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FFAACC</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#AAFFCC</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<p>另外注意的一个点是在定义变量时使用的 <code>-</code> 和 <code>_</code> 的效果是一样的。即 <code>$border-color</code> 和 <code>$border_color</code> 指向的是同一个变量。</p>
<h2 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h2><p>为了避免一些代码的重复，引入了代码的嵌套。看一个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.selected &#123;</span><br><span class="line">    color: #FFAA22;</span><br><span class="line">    h1 &#123;</span><br><span class="line">        color: #FFDD77</span><br><span class="line">    &#125;</span><br><span class="line">    div &#123;</span><br><span class="line">        width: 50px;</span><br><span class="line">        height: 20px;</span><br><span class="line">        span &#123;</span><br><span class="line">            color: #012DD6;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;:hover &#123;</span><br><span class="line">        color: #FAFAFA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>得到的结果如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.selected</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FFAA22</span>; &#125;</span><br><span class="line">  <span class="selector-class">.selected</span> <span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#FFDD77</span>; &#125;</span><br><span class="line">  <span class="selector-class">.selected</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">20px</span>; &#125;</span><br><span class="line">    <span class="selector-class">.selected</span> <span class="selector-tag">div</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#012DD6</span>; &#125;</span><br><span class="line">  <span class="selector-class">.selected</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#FAFAFA</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<p>从中可以看到，嵌套可以将需要重复写选择器的过程嵌套到一个表达式中了。</p>
<h3 id="父选择器标识符-amp"><a href="#父选择器标识符-amp" class="headerlink" title="父选择器标识符 &amp;"></a>父选择器标识符 &amp;</h3><p>从上面的例子中看到有这么一段 <code>&amp;:hover</code> 而在编译结果中得到的结果是 <code>.selected:hover</code> ，其实 <code>&amp;</code> 标识符就代表了父级选择器。就这么简单，不理解的时候把父级选择题替换 <code>&amp;</code> 理解下就简单了。</p>
<h3 id="嵌套css"><a href="#嵌套css" class="headerlink" title="嵌套css"></a>嵌套css</h3><p>sass 中的嵌套是可以多个样式同时嵌套的。 用法见demo。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.container .content &#123;</span><br><span class="line">    h1, h2, h3 &#123;margin-bottom: .8em&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译结果<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.content</span> <span class="selector-tag">h1</span>, <span class="selector-class">.container</span> <span class="selector-class">.content</span> <span class="selector-tag">h2</span>, <span class="selector-class">.container</span> <span class="selector-class">.content</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: .<span class="number">8em</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="子组合选择器和同层选择器"><a href="#子组合选择器和同层选择器" class="headerlink" title="子组合选择器和同层选择器"></a>子组合选择器和同层选择器</h3><p>关于 <code>&gt;</code>、<code>+</code> 和 <code>~</code> 这三个选择器，是 CSS3 中就有的。在 SASS 中同样适用。<br>简单说下三个选择器用途（参考<a href="http://www.w3school.com.cn/cssref/css_selectors.asp" target="_blank" rel="noopener"> CSS 选择器</a>）：</p>
<ul>
<li><code>div&gt;p</code> 选取父元素是 <div> 元素的每个 <p> 元素</p></div></li>
<li><code>div+p</code> 选择 <div> 元素之后紧跟的每个 <p> 元素</p></div></li>
<li><code>p~ul</code> 选择前面有 <p> 元素的每个 <ul> 元素。</ul></p></li>
</ul>
<p>看个官网的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">article &#123;</span><br><span class="line">    ~ article &#123; border-top: 1px dashed #ccc &#125;</span><br><span class="line">    &gt; section &#123; background: #eee &#125;</span><br><span class="line">    dl &gt; &#123;</span><br><span class="line">      dt &#123; color: #333 &#125;</span><br><span class="line">      dd &#123; color: #555 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    nav + &amp; &#123; margin-top: 0 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>动手编译出的结果如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">article</span> ~ <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> dashed <span class="number">#ccc</span>; &#125;</span><br><span class="line"><span class="selector-tag">article</span> &gt; <span class="selector-tag">section</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#eee</span>; &#125;</span><br><span class="line"><span class="selector-tag">article</span> <span class="selector-tag">dl</span> &gt; <span class="selector-tag">dt</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>; &#125;</span><br><span class="line"><span class="selector-tag">article</span> <span class="selector-tag">dl</span> &gt; <span class="selector-tag">dd</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>; &#125;</span><br><span class="line"><span class="selector-tag">nav</span> + <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="嵌套属性"><a href="#嵌套属性" class="headerlink" title="嵌套属性"></a>嵌套属性</h3><p>属性嵌套说白了就是把 <code>margin-bottom</code> 这类有 <code>-</code> 符号隔开的属性拆分开来便于查看和编写。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nav &#123;</span><br><span class="line">    border: &#123;</span><br><span class="line">    style: solid;</span><br><span class="line">    width: 1px;</span><br><span class="line">    color: #ccc;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>这里把 <code>border-style</code> 等属性进行了拆分，结果如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#ccc</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h2><p>sass 提供了 sass 文件导入功能。可以做一些基础样式的复用。用法很简单：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// var.scss</span><br><span class="line">$default-color: #AABBCC;</span><br><span class="line"></span><br><span class="line">.focused &#123;</span><br><span class="line">    color: red;</span><br><span class="line">    margin: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// h1.scss</span><br><span class="line">h1 &#123;</span><br><span class="line">    color: #BBDDFF;</span><br><span class="line">    margin: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// demo.scss</span><br><span class="line">@import &quot;var01&quot;;</span><br><span class="line"></span><br><span class="line">$default-color: #FFAADD !default;</span><br><span class="line"></span><br><span class="line">.selected &#123;</span><br><span class="line">    color: $default-color;</span><br><span class="line">    @import &quot;h1&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上代码中将 <code>var.scss</code> 和 <code>h1.scss</code> 两个文件导入到了 <code>demo.scss</code> 中，最终生成结果如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.focused</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5px</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.selected</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#AABBCC</span>; &#125;</span><br><span class="line">  <span class="selector-class">.selected</span> <span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#BBDDFF</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">10px</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<p>从结果来说说导入的几个注意点：</p>
<ul>
<li>导入文件使用 <code>@import</code> 表达式来导入，导入可以是外部导入也可是嵌套导入。上面例子中 <code>var</code> 是外部导入，而 <code>h1</code> 是嵌套导入的。</li>
<li><code>$default-color: #FFAADD !default;</code> 中的 <code>!default</code> 是定义变量默认值的方式，如果导入文件中有同样的值优先使用导入的值，如果导入文件中没有这个值，使用默认值。</li>
<li>sass 中的 <code>@import</code> 与 css 中的 <code>@import</code> 不同，sass 中是编译的时候就直接导入生成 css 文件了，而 css 中，只有执行到 <code>@import</code> 时，浏览器才会去下载 css 文件，会导致页面加载变慢。</li>
</ul>
<h2 id="静默注释"><a href="#静默注释" class="headerlink" title="静默注释"></a>静默注释</h2><p>就是在 sass 是否保留注释内容的语法。保留注释的方式为：<strong>在CSS语法允许的地方，以 <code>/*...*/</code> 的方式写注释就能在生成的 css 文件中看到。</strong>再来看一个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 不显示</span><br><span class="line">/* 显示 */</span><br><span class="line"></span><br><span class="line">.selected &#123;</span><br><span class="line">    //不显示</span><br><span class="line">    /* 显示 */</span><br><span class="line">    color: #FFAADD; // 不显示</span><br><span class="line">    margin:/* 不显示 */ 10px; /* 显示 */</span><br><span class="line">    /* 显示 */border: 1px dashed /* 不显示 */ #ccc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 不显示</span><br><span class="line">/* 显示 */</span><br></pre></td></tr></table></figure></p>
<p>编译结果正如注释所预测的。</p>
<h2 id="混合器"><a href="#混合器" class="headerlink" title="混合器"></a>混合器</h2><p>混合器在 element 的样式表中用的非常多，是个很强大的功能。混合器以 <code>@mixin</code> 来导出混合内容，使用 <code>@include</code> 来导入混合内容。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>我的理解是：<code>@mixin</code> 类似定义变量一样定义个混合器（编译的时候不显示 <code>@mixin</code> 的内容），<code>@include</code> 获取混合器来替换 <code>@include xxxx</code> 的这行内容。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// mixin.scss</span><br><span class="line">@mixin rounded-corners &#123;</span><br><span class="line">    -moz-border-radius: 5px;</span><br><span class="line">    -webkit-border-radius: 5px;</span><br><span class="line">    border-radius: 5px;</span><br><span class="line">    div &#123;</span><br><span class="line">        width: 50px;</span><br><span class="line">        height: 20px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.name &#123;</span><br><span class="line">    span &#123;</span><br><span class="line">        color: #FFAADD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// include.scss</span><br><span class="line">@import &quot;mixin&quot;;</span><br><span class="line"></span><br><span class="line">.notice &#123;</span><br><span class="line">    background-color: green;</span><br><span class="line">    border: 2px solid #00aa00;</span><br><span class="line">    @include rounded-corners;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里在官方 demo 上加了点代码验证问题。得到结果如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.name</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FFAADD</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.notice</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#00aa00</span>;</span><br><span class="line">  <span class="attribute">-moz-border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">-webkit-border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>; &#125;</span><br><span class="line">  <span class="selector-class">.notice</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">20px</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<p>这个demo验证了：1. <code>@mixin</code> 是一个类似变量的内容。在 <code>@import</code> 导入的内容中只显示了 <code>.name</code> 样式。  2. <code>@include</code> 会替换 <code>@include xxx</code> 这段代码。就算 <code>@mixin</code> 中有各种写法都会应用到 <code>@include</code>中，如嵌套 CSS。</p>
<h3 id="混合器传参"><a href="#混合器传参" class="headerlink" title="混合器传参"></a>混合器传参</h3><p>混合器可以接收 <code>@include</code> 表达式传递的参数。而且，参数可以设置默认值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// mixin.scss</span><br><span class="line">@mixin link-colors($normal: white, $hover: white, $visited: white) &#123;</span><br><span class="line">    color: $normal;</span><br><span class="line">    &amp;:hover &#123; color: $hover; &#125;</span><br><span class="line">    &amp;:visited &#123; color: $visited; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// include.scss</span><br><span class="line">@import &quot;mixin&quot;;</span><br><span class="line"></span><br><span class="line">// 写法一，按照默认顺序传递参数</span><br><span class="line">a &#123;</span><br><span class="line">    @include link-colors(blue, red, green);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 写法二，按照参数名传递参数</span><br><span class="line">b &#123;</span><br><span class="line">    @include link-colors(</span><br><span class="line">      $normal: blue,</span><br><span class="line">      $visited: green,</span><br><span class="line">      $hover: red</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译结果为:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue; &#125;</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red; &#125;</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: green; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">b</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue; &#125;</span><br><span class="line">  <span class="selector-tag">b</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red; &#125;</span><br><span class="line">  <span class="selector-tag">b</span><span class="selector-pseudo">:visited</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: green; &#125;</span><br></pre></td></tr></table></figure></p>
<p>如果说 <code>@include</code> 中不传递参数 <code>@include link-colors();</code> ，那么生成结果的 color 都为默认值 white。</p>
<h3 id="element-中的混合"><a href="#element-中的混合" class="headerlink" title="element 中的混合"></a>element 中的混合</h3><p>在 element 源码中用了不少混合，有一种写法 sass 的快速入门中没有提到。就找一个简单的 el-card 样式来学习下来：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;mixins/mixins&quot;;</span><br><span class="line">@import &quot;common/var&quot;;</span><br><span class="line"></span><br><span class="line">@include b(card) &#123;</span><br><span class="line">  border-radius: $--card-border-radius;</span><br><span class="line">  border: 1px solid $--card-border-color;</span><br><span class="line">  background-color: $--color-white;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  box-shadow: $--box-shadow-light;</span><br><span class="line">  color: $--color-text-primary;</span><br><span class="line"></span><br><span class="line">  @include e(header) &#123;</span><br><span class="line">    padding: #&#123;$--card-padding - 2 $--card-padding&#125;;</span><br><span class="line">    border-bottom: 1px solid $--card-border-color;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @include e(body) &#123;</span><br><span class="line">    padding: $--card-padding;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从中可以看到所有的属性都是使用了 <code>@include</code> 方式进行混合的。最终生成的 CSS 文件如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.el-card</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ebeef5</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">12px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.1);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#303133</span>; &#125;</span><br><span class="line">  <span class="selector-class">.el-card__header</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">18px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#ebeef5</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box; &#125;</span><br><span class="line">  <span class="selector-class">.el-card__body</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<p>先看下导入，其中 <code>var</code> 文件是项目样式变量统一保存的地方；<code>mixin</code> 文件用于混合；再加上几个 <code>@include</code> 表达式，答案一定是在 <code>mixin</code> 中的。我们就直接找到 <code>@mixin b</code> 和 <code>@mixin e</code> 两个混合项。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@mixin b($block) &#123;</span><br><span class="line">  $B: $namespace+&apos;-&apos;+$block !global; // 定义 B 变量：变量名 el-card</span><br><span class="line"></span><br><span class="line">  .#&#123;$B&#125; &#123;</span><br><span class="line">    @content;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@mixin e($element) &#123;</span><br><span class="line">  $E: $element !global;</span><br><span class="line">  $selector: &amp;;</span><br><span class="line">  $currentSelector: &quot;&quot;;</span><br><span class="line">  @each $unit in $element &#123;</span><br><span class="line">    $currentSelector: #&#123;$currentSelector + &quot;.&quot; + $B + $element-separator + $unit + &quot;,&quot;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @if hitAllSpecialNestRule($selector) &#123;</span><br><span class="line">    @at-root &#123;</span><br><span class="line">      #&#123;$selector&#125; &#123;</span><br><span class="line">        #&#123;$currentSelector&#125; &#123;</span><br><span class="line">          @content;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; @else &#123;</span><br><span class="line">    @at-root &#123;</span><br><span class="line">      #&#123;$currentSelector&#125; &#123;</span><br><span class="line">        @content;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>发现有许多 sass 快速入门中没有提到过的语法： <code>@if</code>，<code>@else</code> 等等，这里查阅具体文档列出其功能：</p>
<ul>
<li>@if @else 这两者和任何编程语言的 if … else … 的用法是一样的，条件判断。if 中条件为 true 进入逻辑，否则使用 else 逻辑。</li>
<li>@at-root <a href="https://www.sasscss.com/docs/#at-root" target="_blank" rel="noopener">@at-root</a> 指令导致一个或多个规则被限定输出在文档的根层级上，而不是被嵌套在其父选择器下。</li>
<li>@content 样式内容块可以传递到混入（mixin）包含样式的位置。样式内容块将出现在混入内的任何 @content 指令的位置。这使得可以定义抽象 关联到选择器和指令的解析。</li>
<li>@each in 类似js用法，遍历列表获取每个value值。</li>
<li><code>#{...}</code> 是<a href="https://www.sasscss.com/docs/#interpolation_" target="_blank" rel="noopener">插值语法</a>，用于在选择器和属性名中使用 SassScript 变量，所以 <code>.#{$B}</code> 表达式，如果 <code>$B</code> 的值为 hello-world，那么表达式结果等于 <code>.hello-world</code></li>
</ul>
<p>其实看完这些用法，上面的代码就很好理解了。具体关于 element 样式学习的细节将在下篇博客中详细学习。</p>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>个人感觉继承就是几个样式类写在一起。而且，继承是可以嵌套的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.error &#123;</span><br><span class="line">    border: 1px red;</span><br><span class="line">    background-color: #fdd;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">.seriousError &#123;</span><br><span class="line">    @extend .error;</span><br><span class="line">    border-width: 3px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.error02 &#123;</span><br><span class="line">    @extend .seriousError;</span><br><span class="line">    margin: 5px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译结果为：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.error</span>, <span class="selector-class">.seriousError</span>, <span class="selector-class">.error02</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> red;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.seriousError</span>, <span class="selector-class">.error02</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.error02</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5px</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<p>下面引用下继承的注意事项：</p>
<blockquote>
<ul>
<li>跟混合器相比，继承生成的 css 代码相对更少。因为继承仅仅是重复选择器，而不会重复属性，所以使用继承往往比混合器生成的 css 体积更小。如果你非常关心你站点的速度，请牢记这一点。</li>
<li>继承遵从 css 层叠的规则。当两个不同的 css 规则应用到同一个 html 元素上时，并且这两个不同的 css 规则对同一属性的修饰存在不同的值，css 层叠规则会决定应用哪个样式。相当直观：通常权重更高的选择器胜出，如果权重相同，定义在后边的规则胜出。</li>
</ul>
</blockquote>
<p>所以，其实继承相比混合更简单。继承只是选择器的重复，而混合是用一段代码替换标签 <code>@include</code> 标签。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>由于 element 项目中使用了大量的 sass 样式，所以想了解 element 必须对 sass 有一定了解。本文简单解决了 sass 是什么？基础用法怎么用？两个问题。更加深入的 sass 语法涉及的不多，算是快速入门博客啦。<br>在了解了 sass，能够看懂 element 中的样式表后，就可以愉快的去学习 element 源码啦~</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="VioletJack"/>
            
              <p class="site-author-name" itemprop="name">VioletJack</p>
              <p class="site-description motion-element" itemprop="description">Violetjack 的个人博客，记录了一些技术笔记和思考。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">47</span>
                    <span class="site-state-item-name">Artikel</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">Tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/violetjack" title="GitHub &rarr; https://github.com/violetjack" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:violetjack@foxmail.com" title="E-Mail &rarr; mailto:violetjack@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/u/2640909603/home" title="Weibo &rarr; https://weibo.com/u/2640909603/home" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.jianshu.com/u/54ae4af3a98d" title="JianShu &rarr; https://www.jianshu.com/u/54ae4af3a98d" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>JianShu</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">VioletJack</span>

  

  
</div>


  <div class="powered-by">Erstellt mit  <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.5.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.0</div>




        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
